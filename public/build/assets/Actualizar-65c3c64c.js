import{A as j}from"./LayoutSuperadmi-2cb9848c.js";import{k as I,u as B,r as m,o as R,a as f,c,b as t,d as r,w as x,F as z,e as u,Z as q,f as a,n as V,m as D,g as F,t as g,i as _,p as M,q as T}from"./app-df00ec4e.js";import{s as k}from"./index.esm-b50760ad.js";import{s as E}from"./dropdown.esm-b8162aa9.js";import{s as A}from"./inputnumber.esm-fe2002eb.js";import{s as H}from"./datatable.esm-71078f41.js";import{s as N}from"./column.esm-434bfdc1.js";import{s as Z}from"./confirmdialog.esm-d6ce107e.js";import{s as G}from"./TopMenu-edcbe2b9.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-fc04ebc9.js";const p=v=>(M("data-v-b9ebfebe"),v=v(),T(),v),K=p(()=>a("div",{class:"text-center mb-4"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Actualización Masiva de Notas")],-1)),O={class:"card p-fluid"},Q={class:"grid"},W={class:"col-12 md:col-4"},X={class:"field"},Y=p(()=>a("label",null,"Escuela",-1)),ee={class:"col-12 md:col-4"},ae={class:"field"},se=p(()=>a("label",null,"Periodo",-1)),le={class:"col-12 md:col-2"},oe={class:"field"},te=p(()=>a("label",null,"Nota mínima",-1)),ie={class:"col-12 md:col-2"},re={class:"field"},de=p(()=>a("label",null,"Nota máxima",-1)),ne={class:"flex justify-end gap-3 mt-4"},ce={key:0,class:"card mt-4"},ue={class:"flex items-center gap-2"},pe={key:0,class:"pi pi-arrow-right text-xs text-gray-500"},me={key:1,class:"text-green-500"},_e={class:"mt-4 p-3 bg-gray-100 rounded"},ve=p(()=>a("span",{class:"font-semibold"},"Resumen:",-1)),fe={key:0},ge={key:1},he={__name:"Actualizar",setup(v){const S=I(),h=B(),w=m([]),b=m([]),d=m([]),i=m({escuelas:!1,periodos:!1,preview:!1,execute:!1}),o=m({id_escuela:null,id_periodo:null,nota_minima:0,nota_maxima:20});R(async()=>{try{i.value.escuelas=!0,i.value.periodos=!0;const[l,s]=await Promise.all([f.get("/superadmi/obtener-escuelas"),f.get("/superadmi/obtener-periodos")]);w.value=l.data,b.value=s.data}catch{y("Error al cargar datos iniciales")}finally{i.value.escuelas=!1,i.value.periodos=!1}});const $=async()=>{var l,s;i.value.preview=!0;try{const e=await f.post("/superadmi/notas/preview",o.value);d.value=e.data.data,C(`Previsualización: ${d.value.length} registros afectados`)}catch(e){y(((s=(l=e.response)==null?void 0:l.data)==null?void 0:s.message)||"Error en la previsualización")}finally{i.value.preview=!1}},L=()=>{S.require({message:`¿Estás seguro de actualizar ${d.value.length} registros? Esta acción no se puede deshacer.`,header:"Confirmar Actualización",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí, actualizar",rejectLabel:"Cancelar",accept:()=>U(),reject:()=>{h.add({severity:"info",summary:"Cancelado",detail:"No se realizaron cambios",life:3e3})}})},U=async()=>{var l,s;i.value.execute=!0;try{const e=await f.post("/superadmi/notas/execute",o.value);C(`Actualización completada: ${e.data.affected_rows} registros modificados`),d.value=[]}catch(e){y(((s=(l=e.response)==null?void 0:l.data)==null?void 0:s.message)||"Error en la actualización")}finally{i.value.execute=!1}},P=l=>{const s=b.value.find(e=>e.id_periodo===l);return s?s.nombre:""},C=l=>{h.add({severity:"success",summary:"Éxito",detail:l,life:5e3})},y=l=>{h.add({severity:"error",summary:"Error",detail:l,life:8e3})};return(l,s)=>(u(),c(z,null,[t(r(q),{title:"Actualización de Notas"}),t(j,null,{default:x(()=>[K,a("div",O,[a("div",Q,[a("div",W,[a("div",X,[Y,t(r(E),{modelValue:o.value.id_escuela,"onUpdate:modelValue":s[0]||(s[0]=e=>o.value.id_escuela=e),options:w.value,optionLabel:"nombre",optionValue:"id",placeholder:"Seleccione escuela",class:"w-full",loading:i.value.escuelas},null,8,["modelValue","options","loading"])])]),a("div",ee,[a("div",ae,[se,t(r(E),{modelValue:o.value.id_periodo,"onUpdate:modelValue":s[1]||(s[1]=e=>o.value.id_periodo=e),options:b.value,optionLabel:"nombre",optionValue:"id_periodo",placeholder:"Seleccione periodo",class:"w-full",loading:i.value.periodos},null,8,["modelValue","options","loading"])])]),a("div",le,[a("div",oe,[te,t(r(A),{modelValue:o.value.nota_minima,"onUpdate:modelValue":s[2]||(s[2]=e=>o.value.nota_minima=e),mode:"decimal",min:0,max:20,class:"w-full"},null,8,["modelValue"])])]),a("div",ie,[a("div",re,[de,t(r(A),{modelValue:o.value.nota_maxima,"onUpdate:modelValue":s[3]||(s[3]=e=>o.value.nota_maxima=e),mode:"decimal",min:0,max:20,class:"w-full"},null,8,["modelValue"])])])]),a("div",ne,[t(r(k),{label:"Previsualizar",icon:"pi pi-eye",severity:"info",onClick:$,loading:i.value.preview},null,8,["loading"]),t(r(k),{label:"Ejecutar Actualización",icon:"pi pi-check",severity:"success",onClick:L,disabled:!d.value.length,loading:i.value.execute},null,8,["disabled","loading"])])]),d.value.length?(u(),c("div",ce,[t(r(H),{value:d.value,class:V("p-datatable-sm"),paginator:"",rows:10,tableStyle:"min-width: 100rem",style:{"font-size":"0.8rem"},scrollable:"",scrollHeight:"flex"},{default:x(()=>[t(r(N),{field:"codigo_est",header:"Código Estudiante",frozen:""}),(u(),c(z,null,D(11,e=>t(r(N),{key:e,header:"C"+e,field:"C"+e},{body:x(({data:n})=>[a("div",ue,[a("span",{class:V({"text-red-500":n["C"+e]!==n["actual_C"+e]})},g(n["C"+e]??"-"),3),n["C"+e]!==n["actual_C"+e]?(u(),c("i",pe)):_("",!0),n["C"+e]!==n["actual_C"+e]?(u(),c("span",me,g(n["actual_C"+e]??"-"),1)):_("",!0)])]),_:2},1032,["header","field"])),64))]),_:1},8,["value"]),a("div",_e,[ve,F(" Se actualizarán "+g(d.value.length)+" registros ",1),o.value.id_escuela?(u(),c("span",fe,"de la escuela seleccionada")):_("",!0),o.value.id_periodo?(u(),c("span",ge,"para el periodo "+g(P(o.value.id_periodo)),1)):_("",!0)])])):_("",!0),t(r(Z)),t(r(G))]),_:1})],64))}},Se=J(he,[["__scopeId","data-v-b9ebfebe"]]);export{Se as default};
