import{u as se,r as i,k as ie,l as h,o as ne,c as de,b as t,d as a,w as r,F as re,a as N,e as P,Z as ue,f as s,t as x,g as ce,j as k,a9 as pe,p as ve,q as me}from"./app-df00ec4e.js";import{A as Ie}from"./LayoutSupervisor-adc8305f.js";import{s as be}from"./datatable.esm-71078f41.js";import{s as m}from"./column.esm-434bfdc1.js";import{s as I,a as Ne}from"./index.esm-b50760ad.js";import{s as U}from"./dropdown.esm-b8162aa9.js";import{a as G,b as Ae,s as Ee}from"./TopMenu-edcbe2b9.js";import{s as fe}from"./textarea.esm-d9f19cdd.js";import{s as Oe}from"./confirmdialog.esm-d6ce107e.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-fc04ebc9.js";import"./inputnumber.esm-fe2002eb.js";const S=_=>(ve("data-v-f0dd31f0"),_=_(),me(),_),he={class:"flex justify-between items-start"},Ue={class:"flex flex-wrap items-start",style:{gap:"1rem"}},ye={class:"mb-3",style:{width:"260px"}},Re={class:"flex align-items-center",style:{width:"420px","font-size":"0.9rem","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},_e={class:"mb-3",style:{width:"200px"}},ge={class:"mb-3",style:{width:"200px"}},we={class:"mb-3",style:{width:"220px"}},Pe={class:"flex items-center",style:{gap:".5rem"}},xe={class:"p-input-icon-left"},Se=S(()=>s("i",{class:"pi pi-search"},null,-1)),Le={class:"mt-3"},Ve=S(()=>s("i",{class:"pi pi-download",style:{color:"green"}},null,-1)),ke={class:"line-clamp-2"},Ge={class:"flex gap-2"},Te={class:"w-full flex flex-col gap-3"},De=S(()=>s("label",{class:"block mb-1 text-sm text-gray-600"},"Estado del documento",-1)),Me=S(()=>s("label",{class:"block mb-1 text-sm text-gray-600"},"Observación",-1)),$e={class:"flex justify-end gap-2"},ze={__name:"asignacion",setup(_){let A=null;const Z=se(),c=(l,o,e)=>{Z.add({severity:l,summary:o,detail:e,life:3e3})},y=i(!1),T=ie(),p=i(1),R=i(10),D=i(0),E=i(null),f=i(null),O=i(null),C=i(null),b=i(void 0),g=i(!1),L=i(!1),V=i([]),M=i([]),v=i({}),q=i([{value:"Dictantes",label:"Dictantes"},{value:"Informe",label:"Informe"},{value:"Plan",label:"Plan"},{value:"Resolucion",label:"Resolución"},{value:"Otro",label:"Otro"}]),$=i([{value:1,label:"Aceptado"},{value:0,label:"Rechazado"},{value:null,label:"Pendiente"}]),J=i([{value:1,label:"INGENIERIA AGRONOMICA - PUNO"},{value:2,label:"INGENIERIA AGROINDUSTRIAL - PUNO"},{value:3,label:"INGENIERIA TOPOGRAFICA Y AGRIMENSURA - PUNO"},{value:4,label:"MEDICINA VETERINARIA Y ZOOTECNIA - PUNO"},{value:5,label:"INGENIERIA ECONOMICA - PUNO"},{value:6,label:"CIENCIAS CONTABLES - PUNO"},{value:7,label:"ADMINISTRACION - PUNO"},{value:8,label:"TRABAJO SOCIAL - PUNO"},{value:9,label:"ENFERMERIA - PUNO"},{value:10,label:"INGENIERIA DE MINAS - PUNO"},{value:11,label:"HUMANIDADES - PUNO"},{value:12,label:"SOCIOLOGIA - PUNO"},{value:13,label:"TURISMO - PUNO"},{value:14,label:"ANTROPOLOGIA - PUNO"},{value:15,label:"CIENCIAS DE LA COMUNICACION SOCIAL - PUNO"},{value:16,label:"ARTE - PUNO"},{value:17,label:"BIOLOGIA - PUNO"},{value:18,label:"EDUCACION SECUNDARIA - PUNO"},{value:19,label:"EDUCACION PRIMARIA - PUNO"},{value:20,label:"EDUCACION INICIAL - PUNO"},{value:21,label:"EDUCACION FISICA - PUNO"},{value:22,label:"INGENIERIA ESTADISTICA E INFORMATICA - PUNO"},{value:23,label:"DERECHO - PUNO"},{value:24,label:"INGENIERIA QUIMICA - PUNO"},{value:25,label:"ODONTOLOGIA - PUNO"},{value:26,label:"NUTRICION HUMANA - PUNO"},{value:27,label:"INGENIERIA GEOLOGICA - PUNO"},{value:28,label:"INGENIERIA METALURGICA - PUNO"},{value:29,label:"INGENIERIA CIVIL - PUNO"},{value:30,label:"ARQUITECTURA Y URBANISMO - PUNO"},{value:31,label:"CIENCIAS FISICO MATEMATICAS - PUNO"},{value:32,label:"INGENIERIA AGRICOLA - PUNO"},{value:33,label:"MEDICINA HUMANA - PUNO"},{value:34,label:"INGENIERIA MECANICA ELECTRICA - PUNO"},{value:35,label:"INGENIERIA ELECTRONICA - PUNO"},{value:36,label:"INGENIERIA DE SISTEMAS - PUNO"},{value:37,label:"PSICOLOGIA - PUNO"},{value:38,label:"INGENIERIA ECONOMICA - AZANGARO"},{value:39,label:"INGENIERIA DE MINAS - AZANGARO"},{value:40,label:"INGENIERIA TELECOMUNICACIONES - AZANGARO"},{value:41,label:"CIENCIAS CONTABLES - JULI"},{value:42,label:"ARQUITECTURA Y URBANISMO - JULI"},{value:43,label:"INGENIERIA AGROINDUSTRIAL - JULI"}]),Y=async()=>{L.value=!0;try{const{data:l}=await N.get("periodos");V.value=l.options||[]}finally{L.value=!1}},d=async()=>{const l={term:E.value,paginashoja:R.value,programa:f.value??void 0,periodo:O.value??void 0,tipo:C.value??void 0};b.value!==void 0&&(l.aceptado=b.value);const o=`get-documentos?page=${p.value}`,e=await N.post(o,l);M.value=e.data.datos.data,D.value=e.data.datos.total},Q=l=>{R.value=l.rows,p.value=l.page+1,d()},X=l=>{window.open("../"+l,"_blank")},w=l=>{y.value=!0,v.value={id:l.id,obser:l.obser??"",aceptado:l.aceptado===0?0:l.aceptado===1?1:null}},K=async()=>{const l={id:v.value.id,obser:v.value.obser??"",aceptado:v.value.aceptado===null?"null":v.value.aceptado};await N.post("observar-documento",l),y.value=!1,v.value={},await d();const o=l.aceptado==="null"?"Pendiente":l.aceptado===1?"Aceptado":l.aceptado===0?"Rechazado":"Actualizado";c("success",`Documento ${o}`,"Cambios guardados.")},z=async(l,o)=>{await N.post("cambiar-estado-documento",{id:l.id,aceptado:o}),await d(),c("info",`Estado: ${o===1?"Aceptado":"Rechazado"}`,"")},W=l=>{T.require({message:"¿Está seguro de cambiar el período?",header:"Confirmar cambio de período",icon:"pi pi-exclamation-triangle",accept:async()=>{try{await N.post("cambiar-periodo-documento",{id:l.id,periodo:l.periodo}),d(),c("info","Periodo modificado","")}catch{c("error","ERROR","No se pudo cambiar el periodo.")}},reject:()=>{c("info","Cambio cancelado","No se realizó ningún cambio.")}})},ee=l=>{T.require({message:`¿Eliminar definitivamente el documento "${l.nombre}"?`,header:"Confirmar eliminación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí, eliminar",rejectLabel:"Cancelar",acceptClass:"p-button-danger",accept:async()=>{try{await N.post("eliminar-documento",{id:l.id}),await d(),c("success","Eliminado","Documento eliminado correctamente.")}catch{c("error","Error","No se pudo eliminar el documento.")}}})},ae=()=>{f.value=null,O.value=null,C.value=null,b.value=void 0,E.value=null,p.value=1,d()},le=async()=>{var l,o;try{g.value=!0,A||(A=await pe(()=>import("./xlsx-1a626fb5.js").then(n=>n.x),["assets/xlsx-1a626fb5.js","assets/app-df00ec4e.js","assets/app-bd33cf41.css"]));const e={term:E.value??void 0,paginashoja:1e5,programa:f.value??void 0,periodo:O.value??void 0,tipo:C.value??void 0};b.value!==void 0&&(e.aceptado=b.value);const F=((o=(l=(await N.post("get-documentos?page=1",e)).data)==null?void 0:l.datos)==null?void 0:o.data)??[];if(!F.length){c("warn","Sin datos","No hay registros para exportar."),g.value=!1;return}const B=F.map(n=>({ID:n.id,Periodo:n.periodo??"",Tipo:n.tipo??"",Escuela:n.escuela??"","Fecha Subida":n.fecha_subida??"",Usuario:`${n.username??""} ${n.userlastname??""}`.trim(),URL:n.url??"",Estado:n.aceptado===1?"Aceptado":n.aceptado===0?"Rechazado":"Pendiente",Observación:n.obser??""})),j=A.utils.book_new(),H=A.utils.json_to_sheet(B,{skipHeader:!1});A.utils.book_append_sheet(j,H,"Documentos");const oe=Object.keys(B[0]||{});H["!cols"]=oe.map(n=>({wch:Math.min(Math.max(n.length,16),50)}));const te=new Date().toISOString().slice(0,19).replace("T","_").replace(/:/g,"");A.writeFile(j,`documentos_${te}.xlsx`),c("success","Exportado","Se descargó el Excel.")}catch(e){console.error(e),c("error","Error al exportar","Intenta nuevamente.")}finally{g.value=!1}};return h(E,()=>{p.value=1,d()}),h(f,()=>{p.value=1,d()}),h(O,()=>{p.value=1,d()}),h(C,()=>{p.value=1,d()}),h(b,()=>{p.value=1,d()}),h(R,()=>{p.value=1,d()}),ne(async()=>{await Y(),await d()}),(l,o)=>(P(),de(re,null,[t(a(ue),{title:"Documentos"}),t(Ie,null,{default:r(()=>[s("div",he,[t(a(Oe)),s("div",Ue,[s("div",ye,[t(a(U),{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),options:J.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Seleccione escuela profesional",style:{width:"100%"}},{option:r(e=>[s("div",Re,[s("div",null,x(e.option.label),1)])]),_:1},8,["modelValue","options"])]),s("div",_e,[t(a(U),{modelValue:O.value,"onUpdate:modelValue":o[1]||(o[1]=e=>O.value=e),options:V.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Periodo",style:{width:"100%"},loading:L.value},null,8,["modelValue","options","loading"])]),s("div",ge,[t(a(U),{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=e=>C.value=e),options:q.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Tipo de documento",style:{width:"100%"}},null,8,["modelValue","options"])]),s("div",we,[t(a(U),{modelValue:b.value,"onUpdate:modelValue":o[3]||(o[3]=e=>b.value=e),options:$.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Estado (todos)",style:{width:"100%"}},null,8,["modelValue","options"])]),t(a(I),{label:"Limpiar filtros",icon:"pi pi-filter-slash",class:"p-button-secondary",onClick:ae})]),s("div",Pe,[s("span",xe,[Se,t(a(Ne),{modelValue:E.value,"onUpdate:modelValue":o[4]||(o[4]=e=>E.value=e),placeholder:"Buscar"},null,8,["modelValue"])]),t(a(I),{icon:"pi pi-file-excel",label:"Exportar Excel",severity:"success",loading:g.value,onClick:le},null,8,["loading"])])]),s("div",Le,[t(a(be),{value:M.value,showGridlines:!1,paginator:"",lazy:"",rows:R.value,totalRecords:D.value,rowsPerPageOptions:[10,20,50],first:(p.value-1)*R.value,onPage:Q,class:"p-datatable-sm",tableStyle:"min-width: 50rem",style:{"font-size":".9rem"}},{default:r(()=>[t(a(m),{field:"periodo",header:"Periodo"}),t(a(m),{field:"periodo",header:"Periodo Mod",width:"170px"},{body:r(({data:e})=>[t(a(U),{modelValue:e.periodo,"onUpdate:modelValue":u=>e.periodo=u,options:V.value,optionLabel:"label",optionValue:"value",placeholder:"Seleccione periodo",onChange:u=>W(e),style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),t(a(m),{field:"tipo",header:"TIPO"}),t(a(m),{field:"fecha_subida",header:"FECHA"}),t(a(m),{field:"username",header:"USUARIO"},{body:r(({data:e})=>[ce(x(e.username)+" "+x(e.userlastname),1)]),_:1}),t(a(m),{field:"url",header:"Ver Documento",style:{"min-width":"12rem"}},{body:r(({data:e})=>[t(a(I),{label:"Link",onClick:u=>X(e.url),link:""},{default:r(()=>[Ve]),_:2},1032,["onClick"])]),_:1}),t(a(m),{field:"aceptado",header:"Estado",width:"140px"},{body:r(({data:e})=>[e.aceptado===1?(P(),k(a(G),{key:0,value:"Aceptado",severity:"success",class:"cursor-pointer",onClick:u=>w(e)},null,8,["onClick"])):e.aceptado===0?(P(),k(a(G),{key:1,value:"Rechazado",severity:"danger",class:"cursor-pointer",onClick:u=>w(e)},null,8,["onClick"])):(P(),k(a(G),{key:2,value:"Pendiente",severity:"secondary",class:"cursor-pointer",onClick:u=>w(e)},null,8,["onClick"]))]),_:1}),t(a(m),{header:"Observaciones",style:{"min-width":"12rem"}},{body:r(({data:e})=>[s("div",ke,x(e.obser),1)]),_:1}),t(a(m),{header:"Acciones",width:"120px"},{body:r(({data:e})=>[s("div",Ge,[t(a(I),{class:"secondary",icon:"pi pi-pencil",onClick:u=>w(e),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),t(a(I),{icon:"pi pi-check",severity:"success",onClick:u=>z(e,1),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),t(a(I),{icon:"pi pi-times",severity:"danger",onClick:u=>z(e,0),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),t(a(I),{icon:"pi pi-trash",severity:"danger",outlined:"",onClick:u=>ee(e),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"])])]),_:1})]),_:1},8,["value","rows","totalRecords","first"])]),t(a(Ae),{visible:y.value,"onUpdate:visible":o[8]||(o[8]=e=>y.value=e),modal:"",header:"Actualizar documento",style:{width:"28rem"}},{footer:r(()=>[s("div",$e,[t(a(I),{label:"Cancelar",onClick:o[7]||(o[7]=e=>y.value=!1),severity:"secondary",size:"small"}),t(a(I),{icon:"pi pi-save",label:"Guardar",severity:"success",onClick:K,size:"small"})])]),default:r(()=>[s("div",Te,[s("div",null,[De,t(a(U),{modelValue:v.value.aceptado,"onUpdate:modelValue":o[5]||(o[5]=e=>v.value.aceptado=e),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Selecciona estado",style:{width:"100%"}},null,8,["modelValue","options"])]),s("div",null,[Me,t(a(fe),{modelValue:v.value.obser,"onUpdate:modelValue":o[6]||(o[6]=e=>v.value.obser=e),style:{width:"100%"},variant:"filled",rows:"6"},null,8,["modelValue"])])])]),_:1},8,["visible"]),t(a(Ee))]),_:1})],64))}},ea=Ce(ze,[["__scopeId","data-v-f0dd31f0"]]);export{ea as default};
