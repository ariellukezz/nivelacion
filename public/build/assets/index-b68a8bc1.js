import{A as L}from"./AuthenticatedLayout-5c4a81b3.js";import{u as F,r as E,c as C,a as r,b as e,w as p,F as M,o as _,Z as P,e as d,t as m,h as b,n as B,i as y}from"./app-9957fcc0.js";import{s as $}from"./index.esm-b6b36824.js";import{s as z}from"./TopMenu-5fc87428.js";import{s as D}from"./datatable.esm-42a8ea18.js";import{s as a}from"./column.esm-434bfdc1.js";import{s as R}from"./tag.esm-0a079832.js";import{X as S}from"./xlsx-4fdd4c8a.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./dropdown.esm-7dc5e2ba.js";import"./inputnumber.esm-2a310672.js";const j={class:"p-4 bg-white rounded-lg shadow-xs"},G={class:"card"},V={class:"mb-3"},U={class:"flex justify-between gap-4"},X={class:"flex-1"},H={key:0},J={class:"mb-4 p-4 bg-blue-50 rounded-md"},Y=d("p",{class:"font-semibold"},"Resumen de importación:",-1),Z={key:0},q={key:0,class:"mt-6"},K=d("h3",{class:"font-bold text-red-600 mb-2"},"Registros Duplicados",-1),Q={class:"flex gap-2"},W={key:1,class:"mt-6"},ee=d("h3",{class:"font-bold text-red-600 mb-2"},"Errores en Importación",-1),re={key:1,class:"p-4 text-center text-gray-500 border-2 border-dashed rounded-lg"},ae=d("i",{class:"pi pi-file-excel text-4xl mb-2 text-blue-500"},null,-1),oe=d("p",{class:"text-lg font-medium"},"Suba un archivo Excel con datos de estudiantes",-1),te=d("p",{class:"text-sm mt-1"},"Formatos soportados: .xlsx, .xls",-1),se=[ae,oe,te],ve={__name:"index",setup(le){const w=F(),g=(t,l,i)=>{w.add({severity:t,summary:l,detail:i,life:3e3})},u=E([]),s=E(null),x=E(!1),k=t=>{const l=t.target.files[0];if(!l)return;const i=new FileReader;i.onload=h=>{try{const c=new Uint8Array(h.target.result),f=S.read(c,{type:"array"}),n=f.SheetNames[0],v=f.Sheets[n],N=S.utils.sheet_to_json(v).map(o=>({codigo:o.codigo||"",codigo_est:o.codigo_est||"",dni:o.dni||"",paterno:o.paterno||"",materno:o.materno||"",nombres:o.nombres||"",sexo:o.sexo||"",email:o.email||"",f_nacimiento:o.f_nacimiento||"",ubigeo_nacimiento:o.ubigeo_nacimiento||"",estado_civil:o.estado_civil||"",anio_egreso:o.anio_egreso||"",tipo_colegio:o.tipo_colegio||"",nombre_colegio:o.nombre_colegio||"",ubigeo_colegio:o.ubigeo_colegio||"",apto:o.apto||"",direccion:o.direccion||"",telefono:o.telefono||"",id_programa:o.id_programa||"",id_escuela:o.id_escuela||"",C1:o.C1||0,C2:o.C2||0,C3:o.C3||0,C4:o.C4||0,C5:o.C5||0,C6:o.C6||0,C7:o.C7||0,C8:o.C8||0,C9:o.C9||0,C10:o.C10||0,C11:o.C11||0,C1_R:o.C1_R||0,C2_R:o.C2_R||0,C3_R:o.C3_R||0,C4_R:o.C4_R||0,C5_R:o.C5_R||0,C6_R:o.C6_R||0,C7_R:o.C7_R||0,C8_R:o.C8_R||0,C9_R:o.C9_R||0,C10_R:o.C10_R||0,C11_R:o.C11_R||0,nivelar:o.nivelar||0,no_nivelar:o.no_nivelar||0,anio:o.anio||new Date().getFullYear(),semestre:o.semestre||"2024-I",f_examen:o.f_examen||new Date().toISOString().split("T")[0],t_examen:o.t_examen||"Ordinario",puntaje_examen:o.puntaje_examen||0,modalidad:o.modalidad||"Regular",observacion:o.observacion||"",estado:"Pendiente"}));u.value=N,s.value=null,g("success","Archivo cargado",`${N.length} registros listos para importar`)}catch(c){g("error","Error","Formato de archivo no válido"),console.error(c)}},i.readAsArrayBuffer(l)},I=async()=>{try{g("info","Procesando","Iniciando importación de estudiantes...");const t=await axios.post("/importar-excel-estudiante",{datos:u.value,ignorar_duplicados:x.value});if(s.value=t.data.data,s.value.duplicados.length&&!x.value&&confirm(`Se detectaron ${s.value.duplicados.length} duplicados.
¿Desea continuar ignorándolos e importar el resto?`)){x.value=!0,await I();return}g("success","Importación completada",`Éxitos: ${s.value.registros_exitosos} |
             Duplicados: ${s.value.duplicados.length} |
             Errores: ${s.value.errores.length}`),u.value=u.value.map((l,i)=>({...l,estado:O(i+1,s.value)}))}catch(t){let l="Error desconocido";t.response&&(l=t.response.data.message||t.response.statusText,t.response.data.reporte&&(s.value=t.response.data.reporte,u.value=u.value.map((i,h)=>({...i,estado:O(h+1,s.value)})))),g("error","Error en importación",l),console.error("Error en importación:",t)}},O=(t,l)=>{var c,f,n;return l?((c=l.duplicados)==null?void 0:c.find(v=>v.linea===t))?"Duplicado":(f=l.errores)!=null&&f.includes(t)||((n=l.detalle_errores)==null?void 0:n.find(v=>v.linea===t))?"Error":t<=l.registros_exitosos?"Éxito":"Pendiente":"Pendiente"},A=t=>t.estado||"Pendiente",T=t=>{switch(A(t)){case"Éxito":return"success";case"Error":return"danger";case"Duplicado":return"warning";default:return"info"}};return(t,l)=>(_(),C(M,null,[r(e(P),{title:"Importación Masiva de Estudiantes"}),r(L,null,{default:p(()=>{var i,h,c,f;return[r(e(z)),d("div",j,[d("div",G,[d("div",V,[d("div",U,[d("div",X,[d("input",{type:"file",onChange:k,accept:".xlsx, .xls",class:"w-full"},null,32)]),r(e($),{label:"Importar Estudiantes",icon:"pi pi-upload",disabled:!u.value.length,onClick:I,severity:"info"},null,8,["disabled"])])]),u.value.length?(_(),C("div",H,[d("div",J,[Y,d("p",null,"Registros listos: "+m(u.value.length),1),s.value?(_(),C("p",Z," Éxitos: "+m(s.value.registros_exitosos)+" | Duplicados: "+m(s.value.duplicados.length)+" | Errores: "+m(s.value.errores.length),1)):b("",!0)]),r(e(D),{value:u.value,class:B("p-datatable-sm"),tableStyle:"min-width: 150rem",scrollable:"",scrollHeight:"500px",removableSort:""},{default:p(()=>[r(e(a),{field:"codigo",header:"CODIGO",sortable:!0,frozen:""}),r(e(a),{field:"codigo_est",header:"COD. EST",sortable:!0,frozen:""}),r(e(a),{field:"dni",header:"DNI",sortable:!0,frozen:""}),r(e(a),{field:"paterno",header:"PATERNO",sortable:!0}),r(e(a),{field:"materno",header:"MATERNO",sortable:!0}),r(e(a),{field:"nombres",header:"NOMBRES",sortable:!0}),r(e(a),{field:"sexo",header:"SEXO",sortable:!0}),r(e(a),{field:"email",header:"EMAIL",sortable:!0}),r(e(a),{field:"f_nacimiento",header:"f_nacimiento",sortable:!0}),r(e(a),{field:"ubigeo_nacimiento",header:"UBIGEO NAC.",sortable:!0}),r(e(a),{field:"estado_civil",header:"EST. CIVIL",sortable:!0}),r(e(a),{field:"anio_egreso",header:"AÑO EGRESO",sortable:!0}),r(e(a),{field:"tipo_colegio",header:"TIPO COLEGIO",sortable:!0}),r(e(a),{field:"nombre_colegio",header:"COLEGIO",sortable:!0}),r(e(a),{field:"ubigeo_colegio",header:"UBIGEO COL.",sortable:!0}),r(e(a),{field:"apto",header:"APTO",sortable:!0}),r(e(a),{field:"direccion",header:"DIRECCIÓN",sortable:!0}),r(e(a),{field:"telefono",header:"TELÉFONO",sortable:!0}),r(e(a),{field:"id_programa",header:"ID PROGRAMA",sortable:!0}),r(e(a),{field:"id_escuela",header:"ID ESCUELA",sortable:!0}),r(e(a),{field:"C1",header:"C1",sortable:!0}),r(e(a),{field:"C2",header:"C2",sortable:!0}),r(e(a),{field:"C3",header:"C3",sortable:!0}),r(e(a),{field:"C4",header:"C4",sortable:!0}),r(e(a),{field:"C5",header:"C5",sortable:!0}),r(e(a),{field:"C6",header:"C6",sortable:!0}),r(e(a),{field:"C7",header:"C7",sortable:!0}),r(e(a),{field:"C8",header:"C8",sortable:!0}),r(e(a),{field:"C9",header:"C9",sortable:!0}),r(e(a),{field:"C10",header:"C10",sortable:!0}),r(e(a),{field:"C11",header:"C11",sortable:!0}),r(e(a),{field:"C1_R",header:"C1_R",sortable:!0}),r(e(a),{field:"C2_R",header:"C2_R",sortable:!0}),r(e(a),{field:"C3_R",header:"C3_R",sortable:!0}),r(e(a),{field:"C4_R",header:"C4_R",sortable:!0}),r(e(a),{field:"C5_R",header:"C5_R",sortable:!0}),r(e(a),{field:"C6_R",header:"C6_R",sortable:!0}),r(e(a),{field:"C7_R",header:"C7_R",sortable:!0}),r(e(a),{field:"C8_R",header:"C8_R",sortable:!0}),r(e(a),{field:"C9_R",header:"C9_R",sortable:!0}),r(e(a),{field:"C10_R",header:"C10_R",sortable:!0}),r(e(a),{field:"C11_R",header:"C11_R",sortable:!0}),r(e(a),{field:"nivelar",header:"NIVELAR",sortable:!0}),r(e(a),{field:"no_nivelar",header:"NO_NIVELAR",sortable:!0}),r(e(a),{field:"anio",header:"AÑO",sortable:!0}),r(e(a),{field:"semestre",header:"SEMESTRE",sortable:!0}),r(e(a),{field:"f_examen",header:"F. EXAMEN",sortable:!0}),r(e(a),{field:"t_examen",header:"TIPO EXAMEN",sortable:!0}),r(e(a),{field:"puntaje_examen",header:"PUNTAJE",sortable:!0}),r(e(a),{field:"modalidad",header:"MODALIDAD",sortable:!0}),r(e(a),{field:"observacion",header:"OBSERVACIÓN",sortable:!0}),r(e(a),{header:"ESTADO",bodyClass:"text-center",frozen:"",alignFrozen:"right"},{body:p(({data:n})=>[r(e(R),{value:A(n),severity:T(n)},null,8,["value","severity"])]),_:1})]),_:1},8,["value"]),(h=(i=s.value)==null?void 0:i.duplicados)!=null&&h.length?(_(),C("div",q,[K,r(e(D),{value:s.value.duplicados,class:"p-datatable-sm"},{default:p(()=>[r(e(a),{field:"linea",header:"Línea"}),r(e(a),{field:"dni",header:"DNI"}),r(e(a),{field:"nombre",header:"Nombre"}),r(e(a),{header:"Existe en"},{body:p(({data:n})=>[d("div",Q,[n.tablas.alumnos?(_(),y(e(R),{key:0,value:"Alumnos",severity:"danger"})):b("",!0),n.tablas.matriz?(_(),y(e(R),{key:1,value:"Matriz",severity:"danger"})):b("",!0),n.tablas.datos_ingreso?(_(),y(e(R),{key:2,value:"Ingreso",severity:"danger"})):b("",!0)])]),_:1})]),_:1},8,["value"])])):b("",!0),(f=(c=s.value)==null?void 0:c.errores)!=null&&f.length?(_(),C("div",W,[ee,r(e(D),{value:s.value.detalle_errores,class:"p-datatable-sm"},{default:p(()=>[r(e(a),{field:"linea",header:"Línea"}),r(e(a),{field:"dni",header:"DNI"}),r(e(a),{field:"error",header:"Error"})]),_:1},8,["value"])])):b("",!0)])):(_(),C("div",re,se))])])]}),_:1})],64))}};export{ve as default};
