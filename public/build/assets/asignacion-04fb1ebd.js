import{u as se,r as i,j as ie,k as h,M as ne,c as re,a as o,b as a,w as d,F as de,d as N,o as P,Z as ue,e as s,t as x,f as ce,i as k,a6 as pe,p as ve,m as me}from"./app-e80c1ac6.js";import{A as Ie}from"./LayoutSupervisor-9f646d87.js";import{s as be}from"./datatable.esm-f7bafe9c.js";import{s as m}from"./column.esm-434bfdc1.js";import{s as I,a as Ne}from"./index.esm-a5f97f06.js";import{s as U}from"./dropdown.esm-f34f6695.js";import{a as Ae,s as Ee}from"./TopMenu-63c2463b.js";import{s as Oe}from"./textarea.esm-7716e8c8.js";import{s as fe}from"./confirmdialog.esm-9fa72a93.js";import{s as G}from"./tag.esm-dc7a9c42.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-de17ed91.js";import"./inputnumber.esm-e0bad99e.js";const S=_=>(ve("data-v-85ba1a9f"),_=_(),me(),_),he={class:"flex justify-between items-start"},Ue={class:"flex flex-wrap items-start",style:{gap:"1rem"}},ye={class:"mb-3",style:{width:"260px"}},Re={class:"flex align-items-center",style:{width:"420px","font-size":"0.9rem","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},_e={class:"mb-3",style:{width:"200px"}},ge={class:"mb-3",style:{width:"200px"}},we={class:"mb-3",style:{width:"220px"}},Pe={class:"flex items-center",style:{gap:".5rem"}},xe={class:"p-input-icon-left"},Se=S(()=>s("i",{class:"pi pi-search"},null,-1)),Le={class:"mt-3"},Ve=S(()=>s("i",{class:"pi pi-download",style:{color:"green"}},null,-1)),ke={class:"line-clamp-2"},Ge={class:"flex gap-2"},Te={class:"w-full flex flex-col gap-3"},De=S(()=>s("label",{class:"block mb-1 text-sm text-gray-600"},"Estado del documento",-1)),Me=S(()=>s("label",{class:"block mb-1 text-sm text-gray-600"},"Observación",-1)),$e={class:"flex justify-end gap-2"},ze={__name:"asignacion",setup(_){let A=null;const Z=se(),c=(l,t,e)=>{Z.add({severity:l,summary:t,detail:e,life:3e3})},y=i(!1),T=ie(),p=i(1),R=i(10),D=i(0),E=i(null),O=i(null),f=i(null),C=i(null),b=i(void 0),g=i(!1),L=i(!1),V=i([]),M=i([]),v=i({}),J=i([{value:"Dictantes",label:"Dictantes"},{value:"Informe",label:"Informe"},{value:"Plan",label:"Plan"},{value:"Resolucion",label:"Resolución"},{value:"Otro",label:"Otro"}]),$=i([{value:1,label:"Aceptado"},{value:0,label:"Rechazado"},{value:null,label:"Pendiente"}]),Y=i([{value:1,label:"INGENIERIA AGRONOMICA - PUNO"},{value:2,label:"INGENIERIA AGROINDUSTRIAL - PUNO"},{value:3,label:"INGENIERIA TOPOGRAFICA Y AGRIMENSURA - PUNO"},{value:4,label:"MEDICINA VETERINARIA Y ZOOTECNIA - PUNO"},{value:5,label:"INGENIERIA ECONOMICA - PUNO"},{value:6,label:"CIENCIAS CONTABLES - PUNO"},{value:7,label:"ADMINISTRACION - PUNO"},{value:8,label:"TRABAJO SOCIAL - PUNO"},{value:9,label:"ENFERMERIA - PUNO"},{value:10,label:"INGENIERIA DE MINAS - PUNO"},{value:11,label:"HUMANIDADES - PUNO"},{value:12,label:"SOCIOLOGIA - PUNO"},{value:13,label:"TURISMO - PUNO"},{value:14,label:"ANTROPOLOGIA - PUNO"},{value:15,label:"CIENCIAS DE LA COMUNICACION SOCIAL - PUNO"},{value:16,label:"ARTE - PUNO"},{value:17,label:"BIOLOGIA - PUNO"},{value:18,label:"EDUCACION SECUNDARIA - PUNO"},{value:19,label:"EDUCACION PRIMARIA - PUNO"},{value:20,label:"EDUCACION INICIAL - PUNO"},{value:21,label:"EDUCACION FISICA - PUNO"},{value:22,label:"INGENIERIA ESTADISTICA E INFORMATICA - PUNO"},{value:23,label:"DERECHO - PUNO"},{value:24,label:"INGENIERIA QUIMICA - PUNO"},{value:25,label:"ODONTOLOGIA - PUNO"},{value:26,label:"NUTRICION HUMANA - PUNO"},{value:27,label:"INGENIERIA GEOLOGICA - PUNO"},{value:28,label:"INGENIERIA METALURGICA - PUNO"},{value:29,label:"INGENIERIA CIVIL - PUNO"},{value:30,label:"ARQUITECTURA Y URBANISMO - PUNO"},{value:31,label:"CIENCIAS FISICO MATEMATICAS - PUNO"},{value:32,label:"INGENIERIA AGRICOLA - PUNO"},{value:33,label:"MEDICINA HUMANA - PUNO"},{value:34,label:"INGENIERIA MECANICA ELECTRICA - PUNO"},{value:35,label:"INGENIERIA ELECTRONICA - PUNO"},{value:36,label:"INGENIERIA DE SISTEMAS - PUNO"},{value:37,label:"PSICOLOGIA - PUNO"},{value:38,label:"INGENIERIA ECONOMICA - AZANGARO"},{value:39,label:"INGENIERIA DE MINAS - AZANGARO"},{value:40,label:"INGENIERIA TELECOMUNICACIONES - AZANGARO"},{value:41,label:"CIENCIAS CONTABLES - JULI"},{value:42,label:"ARQUITECTURA Y URBANISMO - JULI"},{value:43,label:"INGENIERIA AGROINDUSTRIAL - JULI"}]),q=async()=>{L.value=!0;try{const{data:l}=await N.get("periodos");V.value=l.options||[]}finally{L.value=!1}},r=async()=>{const l={term:E.value,paginashoja:R.value,programa:O.value??void 0,periodo:f.value??void 0,tipo:C.value??void 0};b.value!==void 0&&(l.aceptado=b.value);const t=`get-documentos?page=${p.value}`,e=await N.post(t,l);M.value=e.data.datos.data,D.value=e.data.datos.total},Q=l=>{R.value=l.rows,p.value=l.page+1,r()},X=l=>{window.open("../"+l,"_blank")},w=l=>{y.value=!0,v.value={id:l.id,obser:l.obser??"",aceptado:l.aceptado===0?0:l.aceptado===1?1:null}},K=async()=>{const l={id:v.value.id,obser:v.value.obser??"",aceptado:v.value.aceptado===null?"null":v.value.aceptado};await N.post("observar-documento",l),y.value=!1,v.value={},await r();const t=l.aceptado==="null"?"Pendiente":l.aceptado===1?"Aceptado":l.aceptado===0?"Rechazado":"Actualizado";c("success",`Documento ${t}`,"Cambios guardados.")},z=async(l,t)=>{await N.post("cambiar-estado-documento",{id:l.id,aceptado:t}),await r(),c("info",`Estado: ${t===1?"Aceptado":"Rechazado"}`,"")},W=l=>{T.require({message:"¿Está seguro de cambiar el período?",header:"Confirmar cambio de período",icon:"pi pi-exclamation-triangle",accept:async()=>{try{await N.post("cambiar-periodo-documento",{id:l.id,periodo:l.periodo}),r(),c("info","Periodo modificado","")}catch{c("error","ERROR","No se pudo cambiar el periodo.")}},reject:()=>{c("info","Cambio cancelado","No se realizó ningún cambio.")}})},ee=l=>{T.require({message:`¿Eliminar definitivamente el documento "${l.nombre}"?`,header:"Confirmar eliminación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí, eliminar",rejectLabel:"Cancelar",acceptClass:"p-button-danger",accept:async()=>{try{await N.post("eliminar-documento",{id:l.id}),await r(),c("success","Eliminado","Documento eliminado correctamente.")}catch{c("error","Error","No se pudo eliminar el documento.")}}})},ae=()=>{O.value=null,f.value=null,C.value=null,b.value=void 0,E.value=null,p.value=1,r()},le=async()=>{var l,t;try{g.value=!0,A||(A=await pe(()=>import("./xlsx-54043cc0.js").then(n=>n.x),["assets/xlsx-54043cc0.js","assets/app-e80c1ac6.js","assets/app-a6416f73.css"]));const e={term:E.value??void 0,paginashoja:1e5,programa:O.value??void 0,periodo:f.value??void 0,tipo:C.value??void 0};b.value!==void 0&&(e.aceptado=b.value);const F=((t=(l=(await N.post("get-documentos?page=1",e)).data)==null?void 0:l.datos)==null?void 0:t.data)??[];if(!F.length){c("warn","Sin datos","No hay registros para exportar."),g.value=!1;return}const B=F.map(n=>({ID:n.id,Periodo:n.periodo??"",Tipo:n.tipo??"",Escuela:n.escuela??"","Fecha Subida":n.fecha_subida??"",Usuario:`${n.username??""} ${n.userlastname??""}`.trim(),URL:n.url??"",Estado:n.aceptado===1?"Aceptado":n.aceptado===0?"Rechazado":"Pendiente",Observación:n.obser??""})),j=A.utils.book_new(),H=A.utils.json_to_sheet(B,{skipHeader:!1});A.utils.book_append_sheet(j,H,"Documentos");const oe=Object.keys(B[0]||{});H["!cols"]=oe.map(n=>({wch:Math.min(Math.max(n.length,16),50)}));const te=new Date().toISOString().slice(0,19).replace("T","_").replace(/:/g,"");A.writeFile(j,`documentos_${te}.xlsx`),c("success","Exportado","Se descargó el Excel.")}catch(e){console.error(e),c("error","Error al exportar","Intenta nuevamente.")}finally{g.value=!1}};return h(E,()=>{p.value=1,r()}),h(O,()=>{p.value=1,r()}),h(f,()=>{p.value=1,r()}),h(C,()=>{p.value=1,r()}),h(b,()=>{p.value=1,r()}),h(R,()=>{p.value=1,r()}),ne(async()=>{await q(),await r()}),(l,t)=>(P(),re(de,null,[o(a(ue),{title:"Documentos"}),o(Ie,null,{default:d(()=>[s("div",he,[o(a(fe)),s("div",Ue,[s("div",ye,[o(a(U),{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),options:Y.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Seleccione escuela profesional",style:{width:"100%"}},{option:d(e=>[s("div",Re,[s("div",null,x(e.option.label),1)])]),_:1},8,["modelValue","options"])]),s("div",_e,[o(a(U),{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),options:V.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Periodo",style:{width:"100%"},loading:L.value},null,8,["modelValue","options","loading"])]),s("div",ge,[o(a(U),{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=e=>C.value=e),options:J.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Tipo de documento",style:{width:"100%"}},null,8,["modelValue","options"])]),s("div",we,[o(a(U),{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=e=>b.value=e),options:$.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Estado (todos)",style:{width:"100%"}},null,8,["modelValue","options"])]),o(a(I),{label:"Limpiar filtros",icon:"pi pi-filter-slash",class:"p-button-secondary",onClick:ae})]),s("div",Pe,[s("span",xe,[Se,o(a(Ne),{modelValue:E.value,"onUpdate:modelValue":t[4]||(t[4]=e=>E.value=e),placeholder:"Buscar"},null,8,["modelValue"])]),o(a(I),{icon:"pi pi-file-excel",label:"Exportar Excel",severity:"success",loading:g.value,onClick:le},null,8,["loading"])])]),s("div",Le,[o(a(be),{value:M.value,showGridlines:!1,paginator:"",lazy:"",rows:R.value,totalRecords:D.value,rowsPerPageOptions:[10,20,50],first:(p.value-1)*R.value,onPage:Q,class:"p-datatable-sm",tableStyle:"min-width: 50rem",style:{"font-size":".9rem"}},{default:d(()=>[o(a(m),{field:"periodo",header:"Periodo"}),o(a(m),{field:"periodo",header:"Periodo Mod",width:"170px"},{body:d(({data:e})=>[o(a(U),{modelValue:e.periodo,"onUpdate:modelValue":u=>e.periodo=u,options:V.value,optionLabel:"label",optionValue:"value",placeholder:"Seleccione periodo",onChange:u=>W(e),style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),o(a(m),{field:"tipo",header:"TIPO"}),o(a(m),{field:"escuela",header:"ESCUELA PROFESIONAL"}),o(a(m),{field:"fecha_subida",header:"FECHA"}),o(a(m),{field:"username",header:"USUARIO"},{body:d(({data:e})=>[ce(x(e.username)+" "+x(e.userlastname),1)]),_:1}),o(a(m),{field:"url",header:"Ver Documento",style:{"min-width":"12rem"}},{body:d(({data:e})=>[o(a(I),{label:"Link",onClick:u=>X(e.url),link:""},{default:d(()=>[Ve]),_:2},1032,["onClick"])]),_:1}),o(a(m),{field:"aceptado",header:"Estado",width:"140px"},{body:d(({data:e})=>[e.aceptado===1?(P(),k(a(G),{key:0,value:"Aceptado",severity:"success",class:"cursor-pointer",onClick:u=>w(e)},null,8,["onClick"])):e.aceptado===0?(P(),k(a(G),{key:1,value:"Rechazado",severity:"danger",class:"cursor-pointer",onClick:u=>w(e)},null,8,["onClick"])):(P(),k(a(G),{key:2,value:"Pendiente",severity:"secondary",class:"cursor-pointer",onClick:u=>w(e)},null,8,["onClick"]))]),_:1}),o(a(m),{header:"Observaciones",style:{"min-width":"12rem"}},{body:d(({data:e})=>[s("div",ke,x(e.obser),1)]),_:1}),o(a(m),{header:"Acciones",width:"120px"},{body:d(({data:e})=>[s("div",Ge,[o(a(I),{class:"secondary",icon:"pi pi-pencil",onClick:u=>w(e),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),o(a(I),{icon:"pi pi-check",severity:"success",onClick:u=>z(e,1),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),o(a(I),{icon:"pi pi-times",severity:"danger",onClick:u=>z(e,0),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),o(a(I),{icon:"pi pi-trash",severity:"danger",outlined:"",onClick:u=>ee(e),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"])])]),_:1})]),_:1},8,["value","rows","totalRecords","first"])]),o(a(Ae),{visible:y.value,"onUpdate:visible":t[8]||(t[8]=e=>y.value=e),modal:"",header:"Actualizar documento",style:{width:"28rem"}},{footer:d(()=>[s("div",$e,[o(a(I),{label:"Cancelar",onClick:t[7]||(t[7]=e=>y.value=!1),severity:"secondary",size:"small"}),o(a(I),{icon:"pi pi-save",label:"Guardar",severity:"success",onClick:K,size:"small"})])]),default:d(()=>[s("div",Te,[s("div",null,[De,o(a(U),{modelValue:v.value.aceptado,"onUpdate:modelValue":t[5]||(t[5]=e=>v.value.aceptado=e),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Selecciona estado",style:{width:"100%"}},null,8,["modelValue","options"])]),s("div",null,[Me,o(a(Oe),{modelValue:v.value.obser,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value.obser=e),style:{width:"100%"},variant:"filled",rows:"6"},null,8,["modelValue"])])])]),_:1},8,["visible"]),o(a(Ee))]),_:1})],64))}},aa=Ce(ze,[["__scopeId","data-v-85ba1a9f"]]);export{aa as default};
