import{K as I,E as V,r as _,l as C,c as h,b as a,w as u,d as e,j as g,i as p,f as o,e as r,t as i,h as D,g as v,J as T}from"./app-f994730f.js";import{s as x}from"./card.esm-2b8579c0.js";import{a as j,s as w}from"./index.esm-0e4f3215.js";import{s as $}from"./radiobutton.esm-0ddcf636.js";import{s as E}from"./message.esm-2f4cbcee.js";import"./basecomponent.esm-b559aace.js";const U={class:"max-w-xl mx-auto p-6"},M=o("h1",{class:"text-xl font-bold mb-4"},"Recuperar contraseña",-1),O=["onSubmit"],R={class:"mb-3"},A=o("label",{class:"block mb-1"},"Tipo de usuario",-1),F={class:"flex gap-4"},J={class:"flex items-center gap-2"},K=o("label",{for:"alumno"},"Alumno",-1),q={class:"flex items-center gap-2"},z=o("label",{for:"docente"},"Docente",-1),G={key:0,class:"p-error"},H={class:"mb-3"},L={class:"block mb-1"},P={key:0,class:"p-error"},Q={class:"mb-2"},W={class:"flex flex-col gap-2"},X={class:"mt-4"},ae={__name:"Recover",setup(Y){const N=I(),l=V({tipo:"",identificador:""}),m=l.errors,f=_(!1),b=_(""),k=_(""),c=_(null),S=async()=>{c.value=null,f.value=!1,await l.post("/recover/lookup",{onSuccess:()=>{const t=N.props.flash||{};t.found&&(f.value=!0,b.value=t.email_masked,k.value=t.lookup_token)}})},d=V({lookup_token:"",modo:"link"});C(k,t=>d.lookup_token=t);const B=async t=>{c.value=null,d.modo=t,await d.post("/recover/send",{preserveScroll:!0,onSuccess:()=>{f.value=!1,b.value="",k.value=""},onError:()=>{const s=d.errors;s&&Object.keys(s).length&&(c.value=Object.values(s)[0])}})};return(t,s)=>{var y;return r(),h("div",U,[M,a(e(x),{class:"mb-4"},{content:u(()=>[o("form",{onSubmit:D(S,["prevent"])},[o("div",R,[A,o("div",F,[o("div",J,[a(e($),{inputId:"alumno",value:"alumno",modelValue:e(l).tipo,"onUpdate:modelValue":s[0]||(s[0]=n=>e(l).tipo=n)},null,8,["modelValue"]),K]),o("div",q,[a(e($),{inputId:"docente",value:"docente",modelValue:e(l).tipo,"onUpdate:modelValue":s[1]||(s[1]=n=>e(l).tipo=n)},null,8,["modelValue"]),z])]),e(m).tipo?(r(),h("small",G,i(e(m).tipo),1)):p("",!0)]),o("div",H,[o("label",L,i(e(l).tipo==="docente"?"DNI del docente":"Código del alumno"),1),a(e(j),{modelValue:e(l).identificador,"onUpdate:modelValue":s[2]||(s[2]=n=>e(l).identificador=n),class:"w-full",placeholder:"Ingrese DNI o código"},null,8,["modelValue"]),e(m).identificador?(r(),h("small",P,i(e(m).identificador),1)):p("",!0)]),a(e(w),{type:"submit",label:"Buscar",loading:e(l).processing},null,8,["loading"])],40,O)]),_:1}),f.value?(r(),g(e(x),{key:0,class:"mb-3"},{content:u(()=>[o("p",Q,[v("Encontramos un usuario con correo: "),o("strong",null,i(b.value),1)]),o("div",W,[a(e(w),{label:"Enviar contraseña temporal",severity:"secondary",outlined:"",onClick:s[3]||(s[3]=n=>B("password")),loading:e(d).processing},null,8,["loading"])])]),_:1})):p("",!0),(y=t.$page.props.flash)!=null&&y.status?(r(),g(e(E),{key:1,severity:"success",closable:!1,class:"mb-2"},{default:u(()=>[v(i(t.$page.props.flash.status),1)]),_:1})):p("",!0),c.value?(r(),g(e(E),{key:2,severity:"error",closable:!1,class:"mb-2"},{default:u(()=>[v(i(c.value),1)]),_:1})):p("",!0),o("div",X,[a(e(T),{href:"/login",class:"underline"},{default:u(()=>[v("Volver al inicio de sesión")]),_:1})])])}}};export{ae as default};
