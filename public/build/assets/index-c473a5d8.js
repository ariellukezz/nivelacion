import{u as te,r as i,j as se,k as C,M as ie,c as ne,a,b as l,w as u,F as de,d as h,o as g,Z as ue,e as s,t as x,f as re,i as G,a6 as ce,p as pe,m as ve}from"./app-9957fcc0.js";import{A as Ie}from"./LayoutSuperadmi-584a8f9c.js";import{s as me}from"./datatable.esm-42a8ea18.js";import{s as v}from"./column.esm-434bfdc1.js";import{s as N,a as Ne}from"./index.esm-b6b36824.js";import{s as U}from"./dropdown.esm-7dc5e2ba.js";import{a as be,s as Ae}from"./TopMenu-5fc87428.js";import{s as Ee}from"./textarea.esm-503b5cfe.js";import{s as Oe}from"./confirmdialog.esm-4f219e05.js";import{s as T}from"./tag.esm-0a079832.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-c81f6204.js";import"./inputnumber.esm-2a310672.js";const S=_=>(pe("data-v-93865855"),_=_(),ve(),_),Ce={class:"flex justify-between items-start"},he={class:"flex flex-wrap items-start",style:{gap:"1rem"}},Ue={class:"mb-3",style:{width:"260px"}},Re={class:"flex align-items-center",style:{width:"420px","font-size":"0.9rem","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},ye={class:"mb-3",style:{width:"200px"}},_e={class:"mb-3",style:{width:"200px"}},Pe={class:"mb-3",style:{width:"220px"}},we={class:"flex items-center",style:{gap:".5rem"}},ge={class:"p-input-icon-left"},xe=S(()=>s("i",{class:"pi pi-search"},null,-1)),Se={class:"mt-3"},Le=S(()=>s("i",{class:"pi pi-download",style:{color:"green"}},null,-1)),Ve={class:"line-clamp-2"},Ge={class:"flex gap-2"},Te={class:"w-full flex flex-col gap-3"},ke=S(()=>s("label",{class:"block mb-1 text-sm text-gray-600"},"Estado del documento",-1)),De=S(()=>s("label",{class:"block mb-1 text-sm text-gray-600"},"Observación",-1)),Me={class:"flex justify-end gap-2"},$e={__name:"index",setup(_){let b=null;const H=te(),I=(t,o,e)=>{H.add({severity:t,summary:o,detail:e,life:3e3})},R=i(!1),Z=se(),r=i(1),y=i(10),k=i(0),A=i(null),E=i(null),O=i(null),f=i(null),m=i(void 0),P=i(!1),L=i(!1),V=i([]),D=i([]),c=i({}),J=i([{value:"Dictantes",label:"Dictantes"},{value:"Informe",label:"Informe"},{value:"Plan",label:"Plan"},{value:"Resolucion",label:"Resolución"},{value:"Otro",label:"Otro"}]),M=i([{value:1,label:"Aceptado"},{value:0,label:"Rechazado"},{value:null,label:"Pendiente"}]),Y=i([{value:1,label:"INGENIERIA AGRONOMICA - PUNO"},{value:2,label:"INGENIERIA AGROINDUSTRIAL - PUNO"},{value:3,label:"INGENIERIA TOPOGRAFICA Y AGRIMENSURA - PUNO"},{value:4,label:"MEDICINA VETERINARIA Y ZOOTECNIA - PUNO"},{value:5,label:"INGENIERIA ECONOMICA - PUNO"},{value:6,label:"CIENCIAS CONTABLES - PUNO"},{value:7,label:"ADMINISTRACION - PUNO"},{value:8,label:"TRABAJO SOCIAL - PUNO"},{value:9,label:"ENFERMERIA - PUNO"},{value:10,label:"INGENIERIA DE MINAS - PUNO"},{value:11,label:"HUMANIDADES - PUNO"},{value:12,label:"SOCIOLOGIA - PUNO"},{value:13,label:"TURISMO - PUNO"},{value:14,label:"ANTROPOLOGIA - PUNO"},{value:15,label:"CIENCIAS DE LA COMUNICACION SOCIAL - PUNO"},{value:16,label:"ARTE - PUNO"},{value:17,label:"BIOLOGIA - PUNO"},{value:18,label:"EDUCACION SECUNDARIA - PUNO"},{value:19,label:"EDUCACION PRIMARIA - PUNO"},{value:20,label:"EDUCACION INICIAL - PUNO"},{value:21,label:"EDUCACION FISICA - PUNO"},{value:22,label:"INGENIERIA ESTADISTICA E INFORMATICA - PUNO"},{value:23,label:"DERECHO - PUNO"},{value:24,label:"INGENIERIA QUIMICA - PUNO"},{value:25,label:"ODONTOLOGIA - PUNO"},{value:26,label:"NUTRICION HUMANA - PUNO"},{value:27,label:"INGENIERIA GEOLOGICA - PUNO"},{value:28,label:"INGENIERIA METALURGICA - PUNO"},{value:29,label:"INGENIERIA CIVIL - PUNO"},{value:30,label:"ARQUITECTURA Y URBANISMO - PUNO"},{value:31,label:"CIENCIAS FISICO MATEMATICAS - PUNO"},{value:32,label:"INGENIERIA AGRICOLA - PUNO"},{value:33,label:"MEDICINA HUMANA - PUNO"},{value:34,label:"INGENIERIA MECANICA ELECTRICA - PUNO"},{value:35,label:"INGENIERIA ELECTRONICA - PUNO"},{value:36,label:"INGENIERIA DE SISTEMAS - PUNO"},{value:37,label:"PSICOLOGIA - PUNO"},{value:38,label:"INGENIERIA ECONOMICA - AZANGARO"},{value:39,label:"INGENIERIA DE MINAS - AZANGARO"},{value:40,label:"INGENIERIA TELECOMUNICACIONES - AZANGARO"},{value:41,label:"CIENCIAS CONTABLES - JULI"},{value:42,label:"ARQUITECTURA Y URBANISMO - JULI"},{value:43,label:"INGENIERIA AGROINDUSTRIAL - JULI"}]),Q=async()=>{L.value=!0;try{const{data:t}=await h.get("periodos");V.value=t.options||[]}finally{L.value=!1}},d=async()=>{const t={term:A.value,paginashoja:y.value,programa:E.value??void 0,periodo:O.value??void 0,tipo:f.value??void 0};m.value!==void 0&&(t.aceptado=m.value);const o=`get-documentos?page=${r.value}`,e=await h.post(o,t);D.value=e.data.datos.data,k.value=e.data.datos.total},q=t=>{y.value=t.rows,r.value=t.page+1,d()},X=t=>{window.open("../"+t,"_blank")},w=t=>{R.value=!0,c.value={id:t.id,obser:t.obser??"",aceptado:t.aceptado===0?0:t.aceptado===1?1:null}},K=async()=>{const t={id:c.value.id,obser:c.value.obser??"",aceptado:c.value.aceptado===null?"null":c.value.aceptado};await h.post("observar-documento",t),R.value=!1,c.value={},await d();const o=t.aceptado==="null"?"Pendiente":t.aceptado===1?"Aceptado":t.aceptado===0?"Rechazado":"Actualizado";I("success",`Documento ${o}`,"Cambios guardados.")},$=async(t,o)=>{await h.post("cambiar-estado-documento",{id:t.id,aceptado:o}),await d(),I("info",`Estado: ${o===1?"Aceptado":"Rechazado"}`,"")},W=t=>{Z.require({message:"¿Está seguro de cambiar el período?",header:"Confirmar cambio de período",icon:"pi pi-exclamation-triangle",accept:async()=>{try{await h.post("cambiar-periodo-documento",{id:t.id,periodo:t.periodo}),d(),I("info","Periodo modificado","")}catch{I("error","ERROR","No se pudo cambiar el periodo.")}},reject:()=>{I("info","Cambio cancelado","No se realizó ningún cambio.")}})},ee=()=>{E.value=null,O.value=null,f.value=null,m.value=void 0,A.value=null,r.value=1,d()},le=async()=>{var t,o;try{P.value=!0,b||(b=await ce(()=>import("./xlsx-4fdd4c8a.js").then(n=>n.x),["assets/xlsx-4fdd4c8a.js","assets/app-9957fcc0.js","assets/app-75a150dc.css"]));const e={term:A.value??void 0,paginashoja:1e5,programa:E.value??void 0,periodo:O.value??void 0,tipo:f.value??void 0};m.value!==void 0&&(e.aceptado=m.value);const z=((o=(t=(await h.post("get-documentos?page=1",e)).data)==null?void 0:t.datos)==null?void 0:o.data)??[];if(!z.length){I("warn","Sin datos","No hay registros para exportar."),P.value=!1;return}const F=z.map(n=>({ID:n.id,Periodo:n.periodo??"",Tipo:n.tipo??"",Escuela:n.escuela??"","Fecha Subida":n.fecha_subida??"",Usuario:`${n.username??""} ${n.userlastname??""}`.trim(),URL:n.url??"",Estado:n.aceptado===1?"Aceptado":n.aceptado===0?"Rechazado":"Pendiente",Observación:n.obser??""})),B=b.utils.book_new(),j=b.utils.json_to_sheet(F,{skipHeader:!1});b.utils.book_append_sheet(B,j,"Documentos");const ae=Object.keys(F[0]||{});j["!cols"]=ae.map(n=>({wch:Math.min(Math.max(n.length,16),50)}));const oe=new Date().toISOString().slice(0,19).replace("T","_").replace(/:/g,"");b.writeFile(B,`documentos_${oe}.xlsx`),I("success","Exportado","Se descargó el Excel.")}catch(e){console.error(e),I("error","Error al exportar","Intenta nuevamente.")}finally{P.value=!1}};return C(A,()=>{r.value=1,d()}),C(E,()=>{r.value=1,d()}),C(O,()=>{r.value=1,d()}),C(f,()=>{r.value=1,d()}),C(m,()=>{r.value=1,d()}),C(y,()=>{r.value=1,d()}),ie(async()=>{await Q(),await d()}),(t,o)=>(g(),ne(de,null,[a(l(ue),{title:"Documentos"}),a(Ie,null,{default:u(()=>[s("div",Ce,[a(l(Oe)),s("div",he,[s("div",Ue,[a(l(U),{modelValue:E.value,"onUpdate:modelValue":o[0]||(o[0]=e=>E.value=e),options:Y.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Seleccione escuela profesional",style:{width:"100%"}},{option:u(e=>[s("div",Re,[s("div",null,x(e.option.label),1)])]),_:1},8,["modelValue","options"])]),s("div",ye,[a(l(U),{modelValue:O.value,"onUpdate:modelValue":o[1]||(o[1]=e=>O.value=e),options:V.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Periodo",style:{width:"100%"},loading:L.value},null,8,["modelValue","options","loading"])]),s("div",_e,[a(l(U),{modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=e=>f.value=e),options:J.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Tipo de documento",style:{width:"100%"}},null,8,["modelValue","options"])]),s("div",Pe,[a(l(U),{modelValue:m.value,"onUpdate:modelValue":o[3]||(o[3]=e=>m.value=e),options:M.value,filter:"",optionLabel:"label",optionValue:"value",placeholder:"Estado (todos)",style:{width:"100%"}},null,8,["modelValue","options"])]),a(l(N),{label:"Limpiar filtros",icon:"pi pi-filter-slash",class:"p-button-secondary",onClick:ee})]),s("div",we,[s("span",ge,[xe,a(l(Ne),{modelValue:A.value,"onUpdate:modelValue":o[4]||(o[4]=e=>A.value=e),placeholder:"Buscar"},null,8,["modelValue"])]),a(l(N),{icon:"pi pi-file-excel",label:"Exportar Excel",severity:"success",loading:P.value,onClick:le},null,8,["loading"])])]),s("div",Se,[a(l(me),{value:D.value,showGridlines:!1,paginator:"",lazy:"",rows:y.value,totalRecords:k.value,rowsPerPageOptions:[10,20,50],first:(r.value-1)*y.value,onPage:q,class:"p-datatable-sm",tableStyle:"min-width: 50rem",style:{"font-size":".9rem"}},{default:u(()=>[a(l(v),{field:"periodo",header:"Periodo"}),a(l(v),{field:"periodo",header:"Periodo Mod",width:"170px"},{body:u(({data:e})=>[a(l(U),{modelValue:e.periodo,"onUpdate:modelValue":p=>e.periodo=p,options:V.value,optionLabel:"label",optionValue:"value",placeholder:"Seleccione periodo",onChange:p=>W(e),style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),a(l(v),{field:"tipo",header:"TIPO"}),a(l(v),{field:"escuela",header:"ESCUELA PROFESIONAL"}),a(l(v),{field:"fecha_subida",header:"FECHA"}),a(l(v),{field:"username",header:"USUARIO"},{body:u(({data:e})=>[re(x(e.username)+" "+x(e.userlastname),1)]),_:1}),a(l(v),{field:"url",header:"Ver Documento",style:{"min-width":"12rem"}},{body:u(({data:e})=>[a(l(N),{label:"Link",onClick:p=>X(e.url),link:""},{default:u(()=>[Le]),_:2},1032,["onClick"])]),_:1}),a(l(v),{field:"aceptado",header:"Estado",width:"140px"},{body:u(({data:e})=>[e.aceptado===1?(g(),G(l(T),{key:0,value:"Aceptado",severity:"success",class:"cursor-pointer",onClick:p=>w(e)},null,8,["onClick"])):e.aceptado===0?(g(),G(l(T),{key:1,value:"Rechazado",severity:"danger",class:"cursor-pointer",onClick:p=>w(e)},null,8,["onClick"])):(g(),G(l(T),{key:2,value:"Pendiente",severity:"secondary",class:"cursor-pointer",onClick:p=>w(e)},null,8,["onClick"]))]),_:1}),a(l(v),{header:"Observaciones",style:{"min-width":"12rem"}},{body:u(({data:e})=>[s("div",Ve,x(e.obser),1)]),_:1}),a(l(v),{header:"Acciones",width:"120px"},{body:u(({data:e})=>[s("div",Ge,[a(l(N),{class:"secondary",icon:"pi pi-pencil",onClick:p=>w(e),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),a(l(N),{icon:"pi pi-check",severity:"success",onClick:p=>$(e,1),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"]),a(l(N),{icon:"pi pi-times",severity:"danger",onClick:p=>$(e,0),size:"small",style:{width:"32px",height:"32px"}},null,8,["onClick"])])]),_:1})]),_:1},8,["value","rows","totalRecords","first"])]),a(l(be),{visible:R.value,"onUpdate:visible":o[8]||(o[8]=e=>R.value=e),modal:"",header:"Actualizar documento",style:{width:"28rem"}},{footer:u(()=>[s("div",Me,[a(l(N),{label:"Cancelar",onClick:o[7]||(o[7]=e=>R.value=!1),severity:"secondary",size:"small"}),a(l(N),{icon:"pi pi-save",label:"Guardar",severity:"success",onClick:K,size:"small"})])]),default:u(()=>[s("div",Te,[s("div",null,[ke,a(l(U),{modelValue:c.value.aceptado,"onUpdate:modelValue":o[5]||(o[5]=e=>c.value.aceptado=e),options:M.value,optionLabel:"label",optionValue:"value",placeholder:"Selecciona estado",style:{width:"100%"}},null,8,["modelValue","options"])]),s("div",null,[De,a(l(Ee),{modelValue:c.value.obser,"onUpdate:modelValue":o[6]||(o[6]=e=>c.value.obser=e),style:{width:"100%"},variant:"filled",rows:"6"},null,8,["modelValue"])])])]),_:1},8,["visible"]),a(l(Ae))]),_:1})],64))}},el=fe($e,[["__scopeId","data-v-93865855"]]);export{el as default};
