import{s as h,a as x}from"./index.esm-a5f97f06.js";import{s as U}from"./dropdown.esm-f34f6695.js";import{a as j,s as A}from"./TopMenu-63c2463b.js";import{A as T}from"./LayoutSuperadmi-6f273db9.js";import{j as B,u as M,r as i,M as q,c as G,a as l,b as s,w as r,F as Z,d as g,o as H,Z as J,e as t,n as K,f as E,t as F}from"./app-e80c1ac6.js";import{s as O}from"./datatable.esm-f7bafe9c.js";import{s as n}from"./column.esm-434bfdc1.js";import{s as Q}from"./confirmdialog.esm-9fa72a93.js";import{s as R}from"./tag.esm-dc7a9c42.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-de17ed91.js";import"./inputnumber.esm-e0bad99e.js";const W=t("div",{class:"text-center mb-4"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Gestión de Periodos")],-1),X={class:"flex flex-col gap-3"},Y=t("label",null,"Nombre",-1),ee={class:"flex gap-3"},ae={class:"flex-1"},oe=t("label",null,"Fecha Inicio",-1),le={class:"flex-1"},se=t("label",null,"Fecha Fin",-1),te=t("label",null,"Estado",-1),ie={class:"flex justify-end mt-3"},re={class:"flex"},ne={class:"mr-2"},we={__name:"Index",setup(de){const N=B(),_=M(),d=i(""),c=i(""),u=i(""),p=i("activo"),v=i(null),w=i([]),m=i(!1),k=i([{label:"Activo",value:"activo"},{label:"Inactivo",value:"inactivo"}]),V=a=>{const o={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString("es-ES",o)},b=async()=>{try{const a=await g.get("get-periodos");w.value=a.data}catch{y("Error al obtener periodos")}},P=async()=>{var a,o;try{const e=v.value?"actualizado":"creado";await g.post("guardar-periodo",{id_periodo:v.value,nombre:d.value,fecha_inicio:c.value,fecha_fin:u.value,estado:p.value}),$(`Periodo ${e} correctamente`),I(),m.value=!1,b()}catch(e){y(((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"Error al guardar periodo")}},S=a=>{N.require({message:`¿Estás seguro de eliminar el periodo "${a.nombre}"?`,header:"Confirmación",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí, eliminar",rejectLabel:"Cancelar",accept:()=>z(a),reject:()=>{_.add({severity:"info",summary:"Cancelado",detail:"No se eliminó el periodo",life:3e3})}})},z=async a=>{var o,e,f;try{await g.get("eliminar-periodo/"+a.id_periodo),$("Periodo eliminado correctamente"),b()}catch(C){const L=((e=(o=C.response)==null?void 0:o.data)==null?void 0:e.message)||(((f=C.response)==null?void 0:f.status)===409?"No se puede eliminar porque tiene datos relacionados":"Error al eliminar periodo");y(L)}},D=a=>{m.value=!0,v.value=a.id_periodo,d.value=a.nombre,c.value=a.fecha_inicio.split("T")[0],u.value=a.fecha_fin.split("T")[0],p.value=a.estado},I=()=>{v.value=null,d.value="",c.value="",u.value="",p.value="activo"},$=a=>{_.add({severity:"success",summary:"Éxito",detail:a,life:3e3})},y=a=>{_.add({severity:"error",summary:"Error",detail:a,life:5e3})};return q(()=>{b()}),(a,o)=>(H(),G(Z,null,[l(s(J),{title:"Periodos"}),l(T,null,{default:r(()=>[W,t("div",null,[l(s(h),{label:"Nuevo Periodo",severity:"info",onClick:o[0]||(o[0]=e=>m.value=!0)}),l(s(j),{visible:m.value,"onUpdate:visible":o[6]||(o[6]=e=>m.value=e),modal:"",header:"Nuevo Periodo",style:{width:"500px"}},{default:r(()=>[t("div",X,[t("div",null,[Y,l(s(x),{type:"text",modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e),class:"w-full"},null,8,["modelValue"])]),t("div",ee,[t("div",ae,[oe,l(s(x),{type:"date",modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=e=>c.value=e),class:"w-full"},null,8,["modelValue"])]),t("div",le,[se,l(s(x),{type:"date",modelValue:u.value,"onUpdate:modelValue":o[3]||(o[3]=e=>u.value=e),class:"w-full"},null,8,["modelValue"])])]),t("div",null,[te,l(s(U),{modelValue:p.value,"onUpdate:modelValue":o[4]||(o[4]=e=>p.value=e),options:k.value,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"])]),t("div",ie,[l(s(h),{label:"Guardar",severity:"info",onClick:o[5]||(o[5]=e=>P())})])])]),_:1},8,["visible"]),l(s(Q)),l(s(A)),l(s(O),{value:w.value,class:K("p-datatable-sm"),paginator:"",rows:10,tableStyle:"min-width: 50rem",style:{"font-size":"0.8rem"}},{default:r(()=>[l(s(n),{field:"id_periodo",header:"ID"}),l(s(n),{field:"nombre",header:"Nombre"}),l(s(n),{field:"fecha_inicio",header:"Fecha Inicio"},{body:r(({data:e})=>[E(F(V(e.fecha_inicio)),1)]),_:1}),l(s(n),{field:"fecha_fin",header:"Fecha Fin"},{body:r(({data:e})=>[E(F(V(e.fecha_fin)),1)]),_:1}),l(s(n),{field:"estado",header:"Estado"},{body:r(({data:e})=>[l(s(R),{value:e.estado,severity:e.estado==="activo"?"success":"danger",rounded:!0,class:"capitalize"},null,8,["value","severity"])]),_:1}),l(s(n),{header:"Acciones",width:"120px"},{body:r(({data:e})=>[t("div",re,[t("div",ne,[l(s(h),{class:"secondary",icon:"pi pi-pencil","aria-label":"Submit",onClick:f=>D(e),size:"small",style:{width:"25px",height:"25px"}},null,8,["onClick"])]),l(s(h),{icon:"pi pi-trash",severity:"danger","aria-label":"Submit",onClick:f=>S(e),size:"small",style:{width:"25px",height:"25px"}},null,8,["onClick"])])]),_:1})]),_:1},8,["value"])])]),_:1})],64))}};export{we as default};
