import{L as I,E as V,r as _,l as C,c as h,b as a,w as u,d as e,j as g,i as p,f as o,e as n,t as i,h as D,g as v,K as T}from"./app-1b559a8b.js";import{s as x}from"./card.esm-b5cbe977.js";import{a as j,s as w}from"./index.esm-490a0fc5.js";import{s as $}from"./radiobutton.esm-9e8d5102.js";import{s as E}from"./message.esm-149aac5e.js";import"./basecomponent.esm-f14400e5.js";import"./index.esm-57370536.js";const U={class:"max-w-xl mx-auto p-6"},K=o("h1",{class:"text-xl font-bold mb-4"},"Recuperar contraseña",-1),M=["onSubmit"],O={class:"mb-3"},R=o("label",{class:"block mb-1"},"Tipo de usuario",-1),A={class:"flex gap-4"},F={class:"flex items-center gap-2"},L=o("label",{for:"alumno"},"Alumno",-1),q={class:"flex items-center gap-2"},z=o("label",{for:"docente"},"Docente",-1),G={key:0,class:"p-error"},H={class:"mb-3"},J={class:"block mb-1"},P={key:0,class:"p-error"},Q={class:"mb-2"},W={class:"flex flex-col gap-2"},X={class:"mt-4"},re={__name:"Recover",setup(Y){const N=I(),l=V({tipo:"",identificador:""}),m=l.errors,f=_(!1),b=_(""),k=_(""),c=_(null),S=async()=>{c.value=null,f.value=!1,await l.post("/recover/lookup",{onSuccess:()=>{const t=N.props.flash||{};t.found&&(f.value=!0,b.value=t.email_masked,k.value=t.lookup_token)}})},d=V({lookup_token:"",modo:"link"});C(k,t=>d.lookup_token=t);const B=async t=>{c.value=null,d.modo=t,await d.post("/recover/send",{preserveScroll:!0,onSuccess:()=>{f.value=!1,b.value="",k.value=""},onError:()=>{const s=d.errors;s&&Object.keys(s).length&&(c.value=Object.values(s)[0])}})};return(t,s)=>{var y;return n(),h("div",U,[K,a(e(x),{class:"mb-4"},{content:u(()=>[o("form",{onSubmit:D(S,["prevent"])},[o("div",O,[R,o("div",A,[o("div",F,[a(e($),{inputId:"alumno",value:"alumno",modelValue:e(l).tipo,"onUpdate:modelValue":s[0]||(s[0]=r=>e(l).tipo=r)},null,8,["modelValue"]),L]),o("div",q,[a(e($),{inputId:"docente",value:"docente",modelValue:e(l).tipo,"onUpdate:modelValue":s[1]||(s[1]=r=>e(l).tipo=r)},null,8,["modelValue"]),z])]),e(m).tipo?(n(),h("small",G,i(e(m).tipo),1)):p("",!0)]),o("div",H,[o("label",J,i(e(l).tipo==="docente"?"DNI del docente":"Código del alumno"),1),a(e(j),{modelValue:e(l).identificador,"onUpdate:modelValue":s[2]||(s[2]=r=>e(l).identificador=r),class:"w-full",placeholder:"Ingrese DNI o código"},null,8,["modelValue"]),e(m).identificador?(n(),h("small",P,i(e(m).identificador),1)):p("",!0)]),a(e(w),{type:"submit",label:"Buscar",loading:e(l).processing},null,8,["loading"])],40,M)]),_:1}),f.value?(n(),g(e(x),{key:0,class:"mb-3"},{content:u(()=>[o("p",Q,[v("Encontramos un usuario con correo: "),o("strong",null,i(b.value),1)]),o("div",W,[a(e(w),{label:"Enviar contraseña temporal",severity:"secondary",outlined:"",onClick:s[3]||(s[3]=r=>B("password")),loading:e(d).processing},null,8,["loading"])])]),_:1})):p("",!0),(y=t.$page.props.flash)!=null&&y.status?(n(),g(e(E),{key:1,severity:"success",closable:!1,class:"mb-2"},{default:u(()=>[v(i(t.$page.props.flash.status),1)]),_:1})):p("",!0),c.value?(n(),g(e(E),{key:2,severity:"error",closable:!1,class:"mb-2"},{default:u(()=>[v(i(c.value),1)]),_:1})):p("",!0),o("div",X,[a(e(T),{href:"/login",class:"underline"},{default:u(()=>[v("Volver al inicio de sesión")]),_:1})])])}}};export{re as default};
