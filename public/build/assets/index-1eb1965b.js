import{r as i,G as E,o as W,j as Y,w as d,a as V,e as $,b as n,d as s,Z,f as o,c as J,t as r,i as K,n as F,a9 as Q,p as ee,q as oe,g as T}from"./app-df00ec4e.js";import{A as te}from"./LayoutSupervisor-adc8305f.js";import{s as ae}from"./datatable.esm-71078f41.js";import{s as u}from"./column.esm-434bfdc1.js";import{s as L}from"./dropdown.esm-b8162aa9.js";import{s as N}from"./index.esm-b50760ad.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./TopMenu-edcbe2b9.js";import"./ResponsiveNavLink-fc04ebc9.js";import"./inputnumber.esm-fe2002eb.js";const m=w=>(ee("data-v-208fbed7"),w=w(),oe(),w),le={class:"p-4 bg-white rounded-lg shadow"},ne=m(()=>o("h2",{class:"text-xl font-semibold mb-4"},"Reporte de Matriculados por Competencia",-1)),re={class:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4"},ie={class:"mb-4 flex items-center gap-3"},de={key:0,class:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4"},ce={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},pe=m(()=>o("div",{class:"text-blue-600 font-semibold"},"Total Registros",-1)),ue={class:"text-2xl font-bold text-blue-700"},me={class:"bg-green-50 p-4 rounded-lg border border-green-200"},_e=m(()=>o("div",{class:"text-green-600 font-semibold"},"Programas",-1)),ge={class:"text-2xl font-bold text-green-700"},fe={class:"bg-purple-50 p-4 rounded-lg border border-purple-200"},be=m(()=>o("div",{class:"text-purple-600 font-semibold"},"Competencias",-1)),ve={class:"text-2xl font-bold text-purple-700"},he={class:"bg-orange-50 p-4 rounded-lg border border-orange-200"},xe=m(()=>o("div",{class:"text-orange-600 font-semibold"},"Periodo",-1)),we={class:"text-2xl font-bold text-orange-700"},ye={class:"font-medium"},Ce={class:"text-sm text-gray-500"},Pe={class:"font-semibold text-sm"},Ve={class:"text-xs text-gray-600"},Le={class:"text-center font-semibold"},ke={class:"text-center text-green-600 font-semibold"},Ee={class:"text-center text-red-600 font-semibold"},Ne={class:"text-center"},Se=m(()=>o("div",{class:"text-center py-8 text-gray-500"},[o("i",{class:"pi pi-info-circle mr-2"}),T(" No se encontraron resultados para los filtros seleccionados ")],-1)),Re=m(()=>o("div",{class:"text-center py-8"},[o("i",{class:"pi pi-spinner pi-spin mr-2"}),T(" Cargando datos... ")],-1)),je={__name:"index",setup(w){const c=i([]),y=i(!1),C=i(!1),k=i([]),S=i([]),R=i([]),j=i([]),f=i(null),b=i(null),v=i(null),h=i(null),M=i(null),D=t=>`${t.programa} (${t.filial})`,p=async()=>{try{y.value=!0;const t={};f.value&&(t.programa=f.value),b.value&&(t.competencia=b.value),v.value&&(t.filial=v.value),h.value&&(t.periodo=h.value);const a=await V.get("reporte-matriculados",{params:t});a.data.estado?(c.value=a.data.datos,M.value=a.data.periodo_filtrado):console.error("Error en la respuesta:",a.data.mensaje)}catch(t){console.error("Error al obtener el reporte:",t)}finally{y.value=!1}},A=async()=>{try{const t=await V.get("get-programas-filial");t.data.estado&&Array.isArray(t.data.programas)?(k.value=t.data.programas,R.value=[...new Set(t.data.programas.map(g=>g.filial))].map(g=>({filial:g}))):k.value=[];const a=await V.post("get-competencias");a.data.estado&&(S.value=a.data.datos.data||[]);const e=await V.get("obtener-periodos");e.data&&(j.value=e.data)}catch(t){console.error("Error al obtener filtros:",t)}},I=()=>{f.value=null,b.value=null,v.value=null,h.value=null,p()};let _=null;const U=async()=>{try{C.value=!0,_||(_=await Q(()=>import("./xlsx-1a626fb5.js").then(l=>l.x),["assets/xlsx-1a626fb5.js","assets/app-df00ec4e.js","assets/app-bd33cf41.css"]));const t=c.value||[];if(!t.length){console.warn("No hay datos para exportar"),C.value=!1;return}const a=t.map(l=>({Programa:l.programa||"",Filial:l.filial||"","CÃ³digo Competencia":l.competencia_codigo||"",Competencia:l.competencia_nombre||"",Docente:l.docente_nombre||"","Total Matriculados":l.total_matriculados||0,"Estudiantes con Nota":l.estudiantes_con_nota||0,"Estudiantes sin Nota":l.estudiantes_sin_nota||0,"Porcentaje con Nota":`${l.porcentaje_con_nota||0}%`})),e=_.utils.book_new(),g=_.utils.json_to_sheet(a,{skipHeader:!1}),H=Object.keys(a[0]).map(l=>{const q=Math.max(l.length,...a.map(G=>String(G[l]??"").length));return{wch:Math.min(Math.max(q+2,12),60)}});g["!cols"]=H,_.utils.book_append_sheet(e,g,"Matriculados");const x=new Date,P=l=>String(l).padStart(2,"0"),X=`${x.getFullYear()}-${P(x.getMonth()+1)}-${P(x.getDate())}_${P(x.getHours())}${P(x.getMinutes())}`;_.writeFile(e,`reporte_matriculados_${X}.xlsx`)}catch(t){console.error("Error al exportar:",t)}finally{C.value=!1}},z=E(()=>c.value.length),B=E(()=>new Set(c.value.map(t=>t.programa_id)).size),O=E(()=>new Set(c.value.map(t=>t.competencia_id)).size);return W(()=>{A(),p()}),(t,a)=>($(),Y(te,null,{default:d(()=>[n(s(Z),{title:"Reporte de Matriculados por Competencia"}),o("div",le,[ne,o("div",re,[n(s(L),{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),options:k.value,optionLabel:D,optionValue:"id",placeholder:"Todos los programas",class:"w-full",onChange:p,showClear:"",filter:""},null,8,["modelValue","options"]),n(s(L),{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value=e),options:S.value,optionLabel:"label",optionValue:"value",placeholder:"Todas las competencias",class:"w-full",onChange:p,showClear:"",filter:""},null,8,["modelValue","options"]),n(s(L),{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value=e),options:R.value,optionLabel:"filial",optionValue:"filial",placeholder:"Todas las filiales",class:"w-full",onChange:p,showClear:"",filter:""},null,8,["modelValue","options"]),n(s(L),{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),options:j.value,optionLabel:"nombre",optionValue:"id_periodo",placeholder:"Seleccionar Periodo",class:"w-full",onChange:p,showClear:"",filter:""},null,8,["modelValue","options"])]),o("div",ie,[n(s(N),{label:"Limpiar Filtros",icon:"pi pi-times",class:"p-button-outlined p-button-sm",onClick:I}),n(s(N),{icon:"pi pi-refresh",label:"Actualizar",class:"p-button-outlined p-button-sm",onClick:p,loading:y.value},null,8,["loading"]),n(s(N),{icon:"pi pi-file-excel",label:"Exportar Excel",severity:"success",loading:C.value,onClick:U},null,8,["loading"])]),c.value.length>0?($(),J("div",de,[o("div",ce,[pe,o("div",ue,r(s(z)),1)]),o("div",me,[_e,o("div",ge,r(s(B)),1)]),o("div",fe,[be,o("div",ve,r(s(O)),1)]),o("div",he,[xe,o("div",we,r(M.value),1)])])):K("",!0),n(s(ae),{value:c.value,loading:y.value,stripedRows:"",paginator:"",rows:11,rowsPerPageOptions:[10,25,50,100],class:"p-datatable-sm",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} registros",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown"},{empty:d(()=>[Se]),loading:d(()=>[Re]),default:d(()=>[n(s(u),{field:"programa",header:"Programa",sortable:""},{body:d(({data:e})=>[o("div",ye,r(e.programa),1),o("div",Ce,r(e.filial),1)]),_:1}),n(s(u),{field:"competencia_nombre",header:"Competencia",sortable:""},{body:d(({data:e})=>[o("div",Pe,r(e.competencia_codigo),1),o("div",Ve,r(e.competencia_nombre),1)]),_:1}),n(s(u),{field:"docente_nombre",header:"Docente",sortable:""},{body:d(({data:e})=>[o("span",{class:F(e.docente_nombre==="SIN DOCENTE"?"text-red-600 font-semibold":"text-gray-700")},r(e.docente_nombre),3)]),_:1}),n(s(u),{field:"total_matriculados",header:"Matriculados",sortable:""},{body:d(({data:e})=>[o("div",Le,r(e.total_matriculados),1)]),_:1}),n(s(u),{field:"estudiantes_con_nota",header:"Con Nota",sortable:""},{body:d(({data:e})=>[o("div",ke,r(e.estudiantes_con_nota),1)]),_:1}),n(s(u),{field:"estudiantes_sin_nota",header:"Sin Nota",sortable:""},{body:d(({data:e})=>[o("div",Ee,r(e.estudiantes_sin_nota),1)]),_:1}),n(s(u),{field:"porcentaje_con_nota",header:"% Con Nota",sortable:""},{body:d(({data:e})=>[o("div",Ne,[o("span",{class:F({"text-green-600 font-semibold":e.porcentaje_con_nota>=80,"text-yellow-600 font-semibold":e.porcentaje_con_nota>=50&&e.porcentaje_con_nota<80,"text-red-600 font-semibold":e.porcentaje_con_nota<50})},r(e.porcentaje_con_nota)+"% ",3)])]),_:1})]),_:1},8,["value","loading"])])]),_:1}))}},He=se(je,[["__scopeId","data-v-208fbed7"]]);export{He as default};
