import{a as L,s as x}from"./index.esm-b6b36824.js";import{s as B}from"./dropdown.esm-7dc5e2ba.js";import{a as M,s as T}from"./TopMenu-5fc87428.js";import{u as U,r as m,k as z,M as A,c as l,a as i,b as d,w,F as k,d as f,o as n,Z as F,e,n as I,t as o,f as g,h as E,l as P}from"./app-9957fcc0.js";import{A as W}from"./LayoutSupervisor-fa40699c.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-c81f6204.js";const Z={class:"min-h-screen max-w-7xl mx-auto bg-gray-50 p-4 md:p-6"},j={class:"max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6 md:p-8"},q=e("div",{class:"text-center mb-6"},[e("h2",{class:"text-3xl font-bold text-gray-800"},"Registro de Ingreso al Evento"),e("p",{class:"text-gray-600 mt-2"},"Sistema de control de acceso para eventos")],-1),G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},H={class:"space-y-6"},J={class:"w-full"},K=e("label",{for:"dni",class:"block text-sm font-medium text-gray-700 mb-1"},"Escanea el DNI o digítalo",-1),O={class:"w-full"},Q=e("label",{for:"evento",class:"block text-sm font-medium text-gray-700 mb-1"},"Evento",-1),X={class:"flex w-full gap-3"},Y={class:"bg-gray-50 p-4 rounded-lg"},ee=e("h3",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Resultado del registro",-1),te={key:0,class:"text-center py-8 text-gray-500"},se=e("i",{class:"pi pi-id-card text-4xl opacity-50 mb-3"},null,-1),ae=e("p",null,"Ingrese un DNI y seleccione un evento para comenzar",-1),oe=[se,ae],re={class:"flex items-center mb-3"},le={key:0,class:"pi pi-check-circle text-green-500 text-xl mr-2"},ne={key:1,class:"pi pi-info-circle text-blue-500 text-xl mr-2"},ie={class:"grid grid-cols-1 gap-2 text-xl"},de=e("strong",null,"Estudiante:",-1),ce=e("strong",null,"Programa:",-1),ue=e("strong",null,"Mesa:",-1),me=e("strong",null,"Número:",-1),_e=e("strong",null,"Serie:",-1),ge={key:0,class:"mt-4 pt-3 border-t border-gray-200"},pe=e("p",{class:"text-sm text-amber-600 flex items-center"},[e("i",{class:"pi pi-exclamation-triangle mr-2"}),g(" Este estudiante ya había ingresado anteriormente. ")],-1),ve=[pe],he={key:0,class:"py-6 text-center text-gray-500"},xe=e("i",{class:"pi pi-spin pi-spinner text-2xl"},null,-1),fe=e("p",{class:"mt-2"},"Cargando resumen...",-1),be=[xe,fe],ye={key:1},we={class:"mb-4"},ke={class:"text-sm text-gray-600"},Ie={class:"text-lg font-semibold"},Ee={class:"overflow-x-auto"},Ne={class:"min-w-full bg-white rounded-lg shadow"},Ve=e("thead",null,[e("tr",{class:"text-left border-b"},[e("th",{class:"p-3"},"Programa"),e("th",{class:"p-3"},"Ingresaron")])],-1),Ce={class:"p-3"},De={class:"p-3 font-semibold"},Re={key:0},Se=e("td",{class:"p-3 text-gray-500",colspan:"2"},"Sin datos para mostrar.",-1),$e=[Se],Le={class:"mt-4 text-right"},We={__name:"Index",setup(Be){const b=U(),c=m(""),u=m(null),y=m([]),s=m(null),v=m(!1),h=m(!1),p=m({total_general:0,por_programa:[]});z(c,a=>{a.length===8&&/^\d{8}$/.test(a)&&V()});const N=async()=>{try{const a=await f.get("get-eventos");y.value=a.data}catch{_("Error al cargar eventos")}},V=async()=>{var a,r;if(!c.value||!u.value){_("Debe ingresar el DNI y seleccionar un evento");return}try{const t=await f.post("registrar-ingreso",{dni:c.value,evento_id:u.value});t.data.success?(s.value={estudiante:t.data.estudiante,asignacion:t.data.asignacion},S(t.data.message)):_(t.data.message)}catch(t){const $=((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.message)||"Error al registrar ingreso";_($)}finally{c.value=""}},C=async()=>{if(!u.value){_("Seleccione un evento para ver el resumen");return}v.value=!0,await D()},D=async()=>{h.value=!0;try{const{data:a}=await f.get(`participantes-evento/${u.value}/resumen`);p.value=a}catch{_("No se pudo cargar el resumen")}finally{h.value=!1}},R=()=>{c.value=""},S=a=>{b.add({severity:"success",summary:"Correcto",detail:a,life:3e3})},_=a=>{b.add({severity:"error",summary:"Error",detail:a,life:5e3})};return A(()=>{N()}),(a,r)=>(n(),l(k,null,[i(d(F),{title:"Registro de Ingresos"}),i(W,null,{default:w(()=>[e("div",Z,[e("div",j,[q,e("div",G,[e("div",H,[e("div",J,[K,i(d(L),{id:"dni",type:"text",modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=t=>c.value=t),class:"w-full",placeholder:"Ingrese DNI del estudiante",autofocus:""},null,8,["modelValue"])]),e("div",O,[Q,i(d(B),{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=t=>u.value=t),options:y.value,optionLabel:"nombre_evento",optionValue:"id",class:"w-full",placeholder:"Seleccione un evento"},null,8,["modelValue","options"])]),e("div",X,[i(d(x),{label:"Limpiar",severity:"secondary",onClick:R,class:"flex-1"}),i(d(x),{label:"Ver resumen",icon:"pi pi-chart-bar",onClick:C,class:"flex-1"})])]),e("div",Y,[ee,s.value?(n(),l("div",{key:1,class:I(["w-full bg-white border p-4 rounded-lg shadow",{"bg-green-50 border-green-200":s.value.estudiante.firma_ingreso===1,"bg-blue-50 border-blue-200":s.value.estudiante.firma_ingreso!==1}])},[e("div",re,[s.value.estudiante.firma_ingreso===1?(n(),l("i",le)):(n(),l("i",ne)),e("h3",{class:I(["text-lg font-semibold",{"text-green-700":s.value.estudiante.firma_ingreso===1,"text-blue-700":s.value.estudiante.firma_ingreso!==1}])},o(s.value.estudiante.firma_ingreso===1?"Ingreso previamente registrado":"Ingreso registrado correctamente"),3)]),e("div",ie,[e("p",null,[de,g(" "+o(s.value.estudiante.nombres)+" "+o(s.value.estudiante.paterno)+" "+o(s.value.estudiante.materno),1)]),e("p",null,[ce,g(" "+o(s.value.estudiante.programa),1)]),e("p",null,[ue,g(" "+o(s.value.asignacion.mesa),1)]),e("p",null,[me,g(" "+o(s.value.asignacion.numero),1)]),e("p",null,[_e,g(" "+o(s.value.asignacion.serie),1)])]),s.value.estudiante.firma_ingreso===1?(n(),l("div",ge,ve)):E("",!0)],2)):(n(),l("div",te,oe))])])])]),i(d(M),{visible:v.value,"onUpdate:visible":r[3]||(r[3]=t=>v.value=t),modal:"",header:"Resumen de ingresados por programa",style:{width:"42rem",maxWidth:"95vw"}},{default:w(()=>[h.value?(n(),l("div",he,be)):(n(),l("div",ye,[e("div",we,[e("p",ke,"Evento ID: "+o(u.value),1),e("p",Ie,"Total general: "+o(p.value.total_general),1)]),e("div",Ee,[e("table",Ne,[Ve,e("tbody",null,[(n(!0),l(k,null,P(p.value.por_programa,t=>(n(),l("tr",{key:t.programa_id,class:"border-b"},[e("td",Ce,o(t.programa),1),e("td",De,o(t.total_ingresados),1)]))),128)),!p.value.por_programa||p.value.por_programa.length===0?(n(),l("tr",Re,$e)):E("",!0)])])]),e("div",Le,[i(d(x),{label:"Cerrar",severity:"secondary",onClick:r[2]||(r[2]=t=>v.value=!1)})])]))]),_:1},8,["visible"]),i(d(T))]),_:1})],64))}};export{We as default};
