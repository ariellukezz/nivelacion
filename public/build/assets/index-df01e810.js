import{r as l,j as D,w as F,a as k,e as r,f as e,y as w,a7 as E,c as a,m as b,F as y,a8 as L,b as V,d as j,i as x,g as U,t as n,n as q}from"./app-1b559a8b.js";import{A as z}from"./LayoutSupervisor-c1857506.js";import{X as f}from"./xlsx-3b169e4d.js";import{s as G}from"./index.esm-490a0fc5.js";import"./TopMenu-b51e71cb.js";import"./index.esm-57370536.js";import"./dialog.esm-529e88fc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-cf2b2672.js";const M={class:"p-4",style:{background:"white"}},R={class:"flex justify-between mb-2 gap-4 flex-wrap"},T=e("label",{for:"periodo"},"Periodo: ",-1),X=["value"],Y={key:0},H=e("label",{for:"programa"},"Programa de Estudio: ",-1),J=["value"],K=e("label",{for:"busqueda"},"Buscar por Nombre o CODIGO: ",-1),Q={class:"flex items-end"},W={key:0,class:"mb-2 text-sm text-gray-600"},Z={key:1,class:"mb-2 text-sm text-gray-600"},ee={key:2,style:{"border-radius":"4px",width:"100%",overflow:"hidden"}},te=e("thead",{style:{height:"30px",color:"white","background-color":"var(--primary-color)",padding:"0px 10px"}},[e("tr",{style:{"font-size":".9rem"}},[e("th",{style:{border:"1px solid #d9d9d9"}},"CODIGO"),e("th",{style:{border:"1px solid #d9d9d9"}},"APELLIDOS Y NOMBRES"),e("th",{style:{border:"1px solid #d9d9d9"}},"UBICACION"),e("th",{style:{border:"1px solid #d9d9d9"}},"PROGRAMA DE ESTUDIO"),e("th",{style:{border:"1px solid #d9d9d9"}},"INGRESO"),e("th",{style:{border:"1px solid #d9d9d9"}},"C1"),e("th",{style:{border:"1px solid #d9d9d9"}},"C2"),e("th",{style:{border:"1px solid #d9d9d9"}},"C3"),e("th",{style:{border:"1px solid #d9d9d9"}},"C4"),e("th",{style:{border:"1px solid #d9d9d9"}},"C5"),e("th",{style:{border:"1px solid #d9d9d9"}},"C6"),e("th",{style:{border:"1px solid #d9d9d9"}},"C7"),e("th",{style:{border:"1px solid #d9d9d9"}},"C8"),e("th",{style:{border:"1px solid #d9d9d9"}},"C9"),e("th",{style:{border:"1px solid #d9d9d9"}},"C10"),e("th",{style:{border:"1px solid #d9d9d9"}},"C11")])],-1),oe={style:{border:"1px solid #d9d9d9","font-weight":".8rem","text-align":"center"}},se={class:"pl-1 pr-1"},re={style:{border:"1px solid #d9d9d9","font-weight":".7rem"}},ae={class:"pl-1 pr-1"},de={style:{border:"1px solid #d9d9d9","font-weight":".8rem","text-align":"center"}},le={class:"pl-1 pr-1"},ne={style:{border:"1px solid #d9d9d9","font-weight":".8rem","text-align":"center"}},ie={class:"pl-1 pr-1"},ue={style:{border:"1px solid #d9d9d9","font-weight":".8rem","text-align":"center"}},ce={class:"pl-1 pr-1"},pe={style:{"text-align":"center","font-weight":"bold"}},ve={key:3,class:"mt-4 flex gap-4 text-xs"},he=e("div",{class:"flex items-center gap-1"},[e("div",{class:"w-4 h-4 bg-green-100 border border-green-400"}),e("span",null,"AP (Aprobado)")],-1),ge=e("div",{class:"flex items-center gap-1"},[e("div",{class:"w-4 h-4 bg-orange-100 border border-orange-400"}),e("span",null,"S/N (Sin Nota)")],-1),_e=e("div",{class:"flex items-center gap-1"},[e("div",{class:"w-4 h-4 bg-red-100 border border-red-400"}),e("span",null,"Nota 0-10")],-1),be=e("div",{class:"flex items-center gap-1"},[e("div",{class:"w-4 h-4 bg-white border border-gray-300"}),e("span",null,"Nota 11-20")],-1),ye=[he,ge,_e,be],Se={__name:"index",setup(xe){const N=l(1),p=l([]),d=l([]),_=l([]),v=l(""),g=l(""),C=l([]),u=l([]),i=l(null),h=l(!1),P=t=>{if(t==="AP")return"bg-green-100 border-green-400";if(t==="S/N")return"bg-orange-100 border-orange-400";{const s=parseFloat(t);if(!isNaN(s)&&s>=0&&s<=10)return"bg-red-100 border-red-400"}return"bg-white"},S=async()=>{try{h.value=!0;const t=await k.get("periodos");let s=[];if(Array.isArray(t.data.raw)?s=t.data.raw:Array.isArray(t.data.periodos)?s=t.data.periodos:Array.isArray(t.data)?s=t.data:Array.isArray(t.data.rows)?s=t.data.rows:console.warn("Formato inesperado en /periodos:",t.data),u.value=s,!Array.isArray(u.value)||u.value.length===0){i.value=null,p.value=[],d.value=[];return}const o=u.value.find(c=>c.estado==="activo");o?i.value=o.id_periodo:i.value=u.value[0].id_periodo,await A()}catch(t){console.error("Error al obtener periodos",t),u.value=[],i.value=null}finally{h.value=!1}},A=async()=>{if(!i.value){p.value=[],d.value=[];return}try{h.value=!0;const t=await k.get("notasperf-supervisor",{params:{page:N.value,periodo:i.value}});p.value=t.data.datos??[],B(),_.value.length>0?(v.value=_.value[0],m()):d.value=[]}catch(t){console.error("Error al obtener estudiantes",t),p.value=[],d.value=[]}finally{h.value=!1}},O=async()=>{v.value="",g.value="",await A()},B=()=>{const t=new Set;p.value.forEach(s=>{t.add(s.programa)}),_.value=Array.from(t)},m=()=>{d.value=p.value.filter(t=>{const s=v.value?t.programa===v.value:!0,o=g.value.toLowerCase(),c=t.codigo_est.includes(g.value)||`${t.paterno} ${t.materno} ${t.nombre}`.toLowerCase().includes(o);return s&&c}),I()},I=()=>{C.value=d.value.map(t=>{const s={codigo_est:t.codigo_est,programa:t.programa,semestre:t.semestre,filial:t.filial,nombreCompleto:`${t.paterno} ${t.materno},  ${t.nombre}`};for(let o=1;o<=11;o++)s[`C${o}`]=t[`C${o}`];return s})},$=()=>{const t=f.utils.json_to_sheet(C.value),s=f.utils.book_new();f.utils.book_append_sheet(s,t,"Estudiantes"),f.writeFile(s,"estudiantes.xlsx")};return S(),(t,s)=>(r(),D(z,null,{default:F(()=>[e("div",M,[e("div",R,[e("div",null,[T,w(e("select",{id:"periodo","onUpdate:modelValue":s[0]||(s[0]=o=>i.value=o),onChange:O},[(r(!0),a(y,null,b(u.value,o=>(r(),a("option",{key:o.id_periodo,value:o.id_periodo},[U(n(o.nombre)+" ",1),o.estado==="activo"?(r(),a("span",Y,"(actual)")):x("",!0)],8,X))),128))],544),[[E,i.value]])]),e("div",null,[H,w(e("select",{id:"programa","onUpdate:modelValue":s[1]||(s[1]=o=>v.value=o),onChange:m},[(r(!0),a(y,null,b(_.value,o=>(r(),a("option",{key:o,value:o},n(o),9,J))),128))],544),[[E,v.value]])]),e("div",null,[K,w(e("input",{id:"busqueda","onUpdate:modelValue":s[2]||(s[2]=o=>g.value=o),onInput:m,type:"text",placeholder:"Buscar..."},null,544),[[L,g.value]])]),e("div",Q,[V(j(G),{label:"Exportar excel",onClick:$,size:"small",style:{height:"40px"},disabled:d.value.length===0},null,8,["disabled"])])]),h.value?(r(),a("div",W," Cargando información... ")):!h.value&&d.value.length===0?(r(),a("div",Z," No se encontraron estudiantes para el período seleccionado. ")):x("",!0),d.value.length>0?(r(),a("table",ee,[te,e("tbody",null,[(r(!0),a(y,null,b(d.value,o=>(r(),a("tr",{key:o.id_estudiante,style:{"font-size":".9rem"}},[e("td",oe,[e("div",se,n(o.codigo_est),1)]),e("td",re,[e("div",ae,n(o.paterno)+" "+n(o.materno)+", "+n(o.nombre),1)]),e("td",de,[e("div",le,n(o.filial),1)]),e("td",ne,[e("div",ie,n(o.programa),1)]),e("td",ue,[e("div",ce,n(o.semestre),1)]),(r(),a(y,null,b(11,c=>e("td",{key:c,style:{border:"1px solid #d9d9d9","min-width":"40px"},class:q(P(o["C"+c]))},[e("div",pe,n(o["C"+c]),1)],2)),64))]))),128))])])):x("",!0),d.value.length>0?(r(),a("div",ve,ye)):x("",!0)])]),_:1}))}};export{Se as default};
