import{s as v}from"./index.esm-a5f97f06.js";import{s as _}from"./dropdown.esm-f34f6695.js";import{s as $}from"./inputnumber.esm-e0bad99e.js";import{s as B}from"./TopMenu-63c2463b.js";import{u as A,r as i,M as D,c,a as o,b as t,w as T,F as y,d as w,o as n,Z as I,e as l,h as x,i as M,l as P,t as d}from"./app-e80c1ac6.js";import{A as Z}from"./LayoutSupervisor-9f646d87.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-de17ed91.js";const q=l("div",{class:"text-center mb-4"},[l("h2",{class:"text-2xl font-bold text-gray-800"},"Sorteo de Participantes del Evento")],-1),z={class:"w-full max-w-full mx-auto flex flex-col items-center gap-2"},H={class:"w-full flex flex-wrap gap-4 justify-center"},J={class:"w-full sm:w-1/2 lg:w-1/4"},K=l("label",{for:"programa"},"Programa",-1),O={class:"w-full sm:w-1/2 lg:w-1/4"},Q=l("label",{for:"escuela"},"Escuela",-1),R={class:"w-full sm:w-1/2 lg:w-1/4"},W=l("label",{for:"facultad"},"Facultad",-1),X={class:"w-full sm:w-1/3 lg:w-1/5"},Y=l("label",{for:"area"},"Área",-1),ee={key:0,class:"w-full sm:w-1/4 lg:w-1/6"},ae=l("label",{for:"numero_ganadores"},"Número de ganadores",-1),le={key:0,class:"w-full mt-4"},oe=l("h3",{class:"text-xl font-semibold"},"Participantes",-1),te={class:"list-disc pl-6"},se={key:1,class:"w-full mt-6"},re=l("h3",{class:"text-4xl font-bold text-green-700 text-center"},"¡Ganadores!",-1),ne={class:"list-none mt-4 w-full px-4"},ue={class:"text-3xl font-bold text-gray-800 truncate"},ie={class:"text-sm text-gray-600"},ce={class:"w-full flex flex-col sm:flex-row justify-center gap-4 mt-6"},he={__name:"Index",setup(de){const b=A(),s=i({programa_id:null,escuela:null,facultad:null,area:null}),V=i([]),k=i([]),E=i([]),S=i([]),p=i([]),m=i(1),u=i([]),g=1,C=async()=>{try{const e=await w.get("filtros");V.value=e.data.programas,k.value=e.data.escuelas,E.value=e.data.facultades,S.value=e.data.areas}catch{f("Error al cargar los filtros")}},j=async()=>{try{const e=await w.get(`participantes-evento/${g}`,{params:s.value});p.value=e.data,u.value=[]}catch{f("Error al cargar participantes")}},F=async()=>{if(m.value<=0||m.value>p.value.length){f("Número de ganadores inválido.");return}try{const e=await w.post("ejecutar-sorteo",{numero_ganadores:m.value,evento_id:g,...s.value});u.value=e.data,h("Sorteo ejecutado. ¡Ahora puedes guardar los ganadores!")}catch{f("Error al ejecutar el sorteo")}},L=async()=>{if(!u.value.length){f("No hay ganadores para guardar.");return}try{await w.post("guardar-ganadores",{evento_id:g,ganadores:u.value.map(e=>({codigo_est:e.codigo_est,orden_sorteo:e.orden_sorteo}))}),h("Ganadores guardados exitosamente.")}catch{f("Error al guardar ganadores.")}},N=()=>{const e=`/supervisor/exportar-ganadores-pdf/${g}`;window.open(e,"_blank")},G=()=>{s.value={programa_id:null,escuela:null,facultad:null,area:null},p.value=[],m.value=1,u.value=[],h("Filtros y datos limpiados.")},h=e=>{b.add({severity:"success",summary:"Éxito",detail:e,life:3e3})},f=e=>{b.add({severity:"error",summary:"Error",detail:e,life:5e3})};return D(()=>{C()}),(e,r)=>(n(),c(y,null,[o(t(I),{title:"Sorteo de Participantes"}),o(Z,null,{default:T(()=>[q,l("div",z,[l("div",H,[l("div",J,[K,o(t(_),{modelValue:s.value.programa_id,"onUpdate:modelValue":r[0]||(r[0]=a=>s.value.programa_id=a),options:V.value,optionLabel:"programa",optionValue:"id",placeholder:"Selecciona un programa",class:"w-full",filter:""},null,8,["modelValue","options"])]),l("div",O,[Q,o(t(_),{modelValue:s.value.escuela,"onUpdate:modelValue":r[1]||(r[1]=a=>s.value.escuela=a),options:k.value,optionLabel:"escuela",optionValue:"escuela",placeholder:"Selecciona una escuela",class:"w-full",filter:""},null,8,["modelValue","options"])]),l("div",R,[W,o(t(_),{modelValue:s.value.facultad,"onUpdate:modelValue":r[2]||(r[2]=a=>s.value.facultad=a),options:E.value,optionLabel:"facultad",optionValue:"facultad",placeholder:"Selecciona una facultad",class:"w-full",filter:""},null,8,["modelValue","options"])]),l("div",X,[Y,o(t(_),{modelValue:s.value.area,"onUpdate:modelValue":r[3]||(r[3]=a=>s.value.area=a),options:S.value,optionLabel:"area",optionValue:"area",placeholder:"Selecciona un área",class:"w-full"},null,8,["modelValue","options"])]),p.value.length>0?(n(),c("div",ee,[ae,o(t($),{modelValue:m.value,"onUpdate:modelValue":r[4]||(r[4]=a=>m.value=a),min:"1",max:p.value.length,placeholder:"Número de ganadores",class:"w-full"},null,8,["modelValue","max"])])):x("",!0),o(t(v),{label:"Cargar Participantes",severity:"info",onClick:j,class:"w-full sm:w-1/4 lg:w-1/6"}),m.value>0?(n(),M(t(v),{key:1,label:"Ejecutar Sorteo",severity:"success",onClick:F,class:"w-full sm:w-1/4 lg:w-1/6"})):x("",!0),o(t(v),{label:"Limpiar Todo",severity:"danger",onClick:G,class:"w-full sm:w-auto",icon:"pi pi-times"})]),p.value.length>0&&!u.value.length?(n(),c("div",le,[oe,l("ul",te,[(n(!0),c(y,null,P(p.value,(a,U)=>(n(),c("li",{key:U},d(a.nombres)+" "+d(a.paterno)+" ("+d(a.programa)+") ",1))),128))])])):x("",!0),u.value.length>0?(n(),c("div",se,[re,l("ul",ne,[(n(!0),c(y,null,P(u.value,a=>(n(),c("li",{key:a.codigo_est,class:"my-3 text-left flex items-baseline gap-x-4 whitespace-nowrap overflow-hidden"},[l("span",ue,d(a.orden_sorteo)+". "+d(a.nombres)+" "+d(a.paterno)+" "+d(a.materno),1),l("span",ie," (Programa: "+d(a.programa)+") ",1)]))),128))]),l("div",ce,[o(t(v),{label:"Guardar Ganadores",severity:"primary",onClick:L,class:"px-6 py-3 text-lg"}),o(t(v),{label:"Exportar PDF",severity:"warning",icon:"pi pi-file-pdf",onClick:N,class:"px-6 py-3 text-lg"})])])):x("",!0)]),o(t(B))]),_:1})],64))}};export{he as default};
