import{A as P}from"./LayoutSuperadmi-c480e171.js";import{j as I,u as B,r as _,L as R,d as f,c as n,a as t,b as r,w as x,F as z,o as u,Z as D,e as a,n as V,l as F,f as M,t as h,h as m,p as T,m as q}from"./app-bd54c57e.js";import{a as E,s as H}from"./TopMenu-de7492fc.js";import{b as k,c as A,s as Z,a as N}from"./column.esm-5ff7deba.js";import{s as G}from"./confirmdialog.esm-4c2d71e1.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import"./ResponsiveNavLink-ebf260cd.js";const p=v=>(T("data-v-b9ebfebe"),v=v(),q(),v),K=p(()=>a("div",{class:"text-center mb-4"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Actualización Masiva de Notas")],-1)),O={class:"card p-fluid"},Q={class:"grid"},W={class:"col-12 md:col-4"},X={class:"field"},Y=p(()=>a("label",null,"Escuela",-1)),ee={class:"col-12 md:col-4"},ae={class:"field"},se=p(()=>a("label",null,"Periodo",-1)),le={class:"col-12 md:col-2"},oe={class:"field"},te=p(()=>a("label",null,"Nota mínima",-1)),ie={class:"col-12 md:col-2"},re={class:"field"},de=p(()=>a("label",null,"Nota máxima",-1)),ce={class:"flex justify-end gap-3 mt-4"},ne={key:0,class:"card mt-4"},ue={class:"flex items-center gap-2"},pe={key:0,class:"pi pi-arrow-right text-xs text-gray-500"},_e={key:1,class:"text-green-500"},me={class:"mt-4 p-3 bg-gray-100 rounded"},ve=p(()=>a("span",{class:"font-semibold"},"Resumen:",-1)),fe={key:0},he={key:1},ge={__name:"Actualizar",setup(v){const S=I(),g=B(),w=_([]),b=_([]),d=_([]),i=_({escuelas:!1,periodos:!1,preview:!1,execute:!1}),o=_({id_escuela:null,id_periodo:null,nota_minima:0,nota_maxima:20});R(async()=>{try{i.value.escuelas=!0,i.value.periodos=!0;const[l,s]=await Promise.all([f.get("/superadmi/obtener-escuelas"),f.get("/superadmi/obtener-periodos")]);w.value=l.data,b.value=s.data}catch{y("Error al cargar datos iniciales")}finally{i.value.escuelas=!1,i.value.periodos=!1}});const $=async()=>{var l,s;i.value.preview=!0;try{const e=await f.post("/superadmi/notas/preview",o.value);d.value=e.data.data,C(`Previsualización: ${d.value.length} registros afectados`)}catch(e){y(((s=(l=e.response)==null?void 0:l.data)==null?void 0:s.message)||"Error en la previsualización")}finally{i.value.preview=!1}},L=()=>{S.require({message:`¿Estás seguro de actualizar ${d.value.length} registros? Esta acción no se puede deshacer.`,header:"Confirmar Actualización",icon:"pi pi-exclamation-triangle",acceptLabel:"Sí, actualizar",rejectLabel:"Cancelar",accept:()=>U(),reject:()=>{g.add({severity:"info",summary:"Cancelado",detail:"No se realizaron cambios",life:3e3})}})},U=async()=>{var l,s;i.value.execute=!0;try{const e=await f.post("/superadmi/notas/execute",o.value);C(`Actualización completada: ${e.data.affected_rows} registros modificados`),d.value=[]}catch(e){y(((s=(l=e.response)==null?void 0:l.data)==null?void 0:s.message)||"Error en la actualización")}finally{i.value.execute=!1}},j=l=>{const s=b.value.find(e=>e.id_periodo===l);return s?s.nombre:""},C=l=>{g.add({severity:"success",summary:"Éxito",detail:l,life:5e3})},y=l=>{g.add({severity:"error",summary:"Error",detail:l,life:8e3})};return(l,s)=>(u(),n(z,null,[t(r(D),{title:"Actualización de Notas"}),t(P,null,{default:x(()=>[K,a("div",O,[a("div",Q,[a("div",W,[a("div",X,[Y,t(r(k),{modelValue:o.value.id_escuela,"onUpdate:modelValue":s[0]||(s[0]=e=>o.value.id_escuela=e),options:w.value,optionLabel:"nombre",optionValue:"id",placeholder:"Seleccione escuela",class:"w-full",loading:i.value.escuelas},null,8,["modelValue","options","loading"])])]),a("div",ee,[a("div",ae,[se,t(r(k),{modelValue:o.value.id_periodo,"onUpdate:modelValue":s[1]||(s[1]=e=>o.value.id_periodo=e),options:b.value,optionLabel:"nombre",optionValue:"id_periodo",placeholder:"Seleccione periodo",class:"w-full",loading:i.value.periodos},null,8,["modelValue","options","loading"])])]),a("div",le,[a("div",oe,[te,t(r(A),{modelValue:o.value.nota_minima,"onUpdate:modelValue":s[2]||(s[2]=e=>o.value.nota_minima=e),mode:"decimal",min:0,max:20,class:"w-full"},null,8,["modelValue"])])]),a("div",ie,[a("div",re,[de,t(r(A),{modelValue:o.value.nota_maxima,"onUpdate:modelValue":s[3]||(s[3]=e=>o.value.nota_maxima=e),mode:"decimal",min:0,max:20,class:"w-full"},null,8,["modelValue"])])])]),a("div",ce,[t(r(E),{label:"Previsualizar",icon:"pi pi-eye",severity:"info",onClick:$,loading:i.value.preview},null,8,["loading"]),t(r(E),{label:"Ejecutar Actualización",icon:"pi pi-check",severity:"success",onClick:L,disabled:!d.value.length,loading:i.value.execute},null,8,["disabled","loading"])])]),d.value.length?(u(),n("div",ne,[t(r(Z),{value:d.value,class:V("p-datatable-sm"),paginator:"",rows:10,tableStyle:"min-width: 100rem",style:{"font-size":"0.8rem"},scrollable:"",scrollHeight:"flex"},{default:x(()=>[t(r(N),{field:"codigo_est",header:"Código Estudiante",frozen:""}),(u(),n(z,null,F(11,e=>t(r(N),{key:e,header:"C"+e,field:"C"+e},{body:x(({data:c})=>[a("div",ue,[a("span",{class:V({"text-red-500":c["C"+e]!==c["actual_C"+e]})},h(c["C"+e]??"-"),3),c["C"+e]!==c["actual_C"+e]?(u(),n("i",pe)):m("",!0),c["C"+e]!==c["actual_C"+e]?(u(),n("span",_e,h(c["actual_C"+e]??"-"),1)):m("",!0)])]),_:2},1032,["header","field"])),64))]),_:1},8,["value"]),a("div",me,[ve,M(" Se actualizarán "+h(d.value.length)+" registros ",1),o.value.id_escuela?(u(),n("span",fe,"de la escuela seleccionada")):m("",!0),o.value.id_periodo?(u(),n("span",he,"para el periodo "+h(j(o.value.id_periodo)),1)):m("",!0)])])):m("",!0),t(r(G)),t(r(H))]),_:1})],64))}},Ee=J(ge,[["__scopeId","data-v-b9ebfebe"]]);export{Ee as default};
